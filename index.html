<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sapo Tracker - Il Tuo Assistente Finanziario</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#06b6d4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sapo Tracker">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Crypto.js per crittografia -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <!-- SortableJS per drag & drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            background: #0f172a;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* 🌌 BACKGROUND OTTIMIZZATO MOBILE-FIRST */
        .lava-lamp-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        /* 📱 MOBILE: Background semplificato per performance */
        @media (max-width: 768px) {
            .lava-lamp-container {
                background: linear-gradient(135deg, 
                    #0f172a 0%, 
                    #1e293b 50%, 
                    #0f172a 100%);
                animation: none; /* Disabilita animazioni pesanti su mobile */
            }
        }
        
        /* 💻 DESKTOP: Background complesso solo su schermi grandi */
        @media (min-width: 769px) {
            .lava-lamp-container {
                background: 
                    radial-gradient(circle at 10% 90%, rgba(29, 78, 216, 0.25) 0%, transparent 70%),
                    radial-gradient(circle at 90% 10%, rgba(139, 92, 246, 0.2) 0%, transparent 70%),
                    radial-gradient(circle at 20% 50%, rgba(6, 182, 212, 0.18) 0%, transparent 65%),
                    radial-gradient(circle at 80% 60%, rgba(236, 72, 153, 0.15) 0%, transparent 60%),
                    linear-gradient(135deg, 
                        #030816 0%, 
                        #0c1424 20%, 
                        #151d2a 40%, 
                        #253041 60%, 
                        #151d2a 80%, 
                        #030816 100%);
                will-change: transform;
                animation: backgroundPulse 30s ease-in-out infinite;
            }
        }

        @keyframes backgroundPulse {
            0%, 100% { 
                filter: brightness(1) saturate(1.1);
            }
            50% { 
                filter: brightness(1.05) saturate(1.2);
            }
        }

        /* 🌟 SISTEMA PARTICELLARE OTTIMIZZATO */
        .particle-system {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        /* 📱 MOBILE: Disabilita particelle per performance */
        @media (max-width: 768px) {
            .particle-system {
                display: none;
            }
        }
        
        /* 💻 DESKTOP: Mostra particelle solo su schermi grandi */
        @media (min-width: 769px) {
            .particle-system {
                display: block;
            }
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            will-change: transform, opacity;
        }

        /* Particella 1 - Blu Elettrico */
        .particle-1 {
            width: 180px;
            height: 180px;
            background: radial-gradient(circle, 
                rgba(59, 130, 246, 0.4) 0%, 
                rgba(147, 197, 253, 0.2) 50%, 
                transparent 70%);
            top: 20%;
            left: 10%;
            animation: particleFloat1 25s ease-in-out infinite, particleGlow 8s ease-in-out infinite;
            filter: blur(15px) brightness(1.3);
        }

        /* Particella 2 - Viola Quantum */
        .particle-2 {
            width: 140px;
            height: 140px;
            background: radial-gradient(circle, 
                rgba(139, 92, 246, 0.35) 0%, 
                rgba(196, 181, 253, 0.18) 50%, 
                transparent 70%);
            top: 60%;
            right: 15%;
            animation: particleFloat2 32s ease-in-out infinite reverse, particleGlow 12s ease-in-out infinite;
            filter: blur(18px) brightness(1.4);
        }

        /* Particella 3 - Turchese Plasma */
        .particle-3 {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, 
                rgba(6, 182, 212, 0.3) 0%, 
                rgba(103, 232, 249, 0.15) 50%, 
                transparent 70%);
            bottom: 25%;
            left: 40%;
            animation: particleFloat3 28s ease-in-out infinite, particleGlow 15s ease-in-out infinite;
            filter: blur(12px) brightness(1.25) saturate(1.8);
        }

        /* Particella 4 - Rosa Neon */
        .particle-4 {
            width: 160px;
            height: 160px;
            background: radial-gradient(circle, 
                rgba(236, 72, 153, 0.38) 0%, 
                rgba(251, 207, 232, 0.2) 50%, 
                transparent 70%);
            top: 35%;
            left: 75%;
            animation: particleFloat4 35s ease-in-out infinite reverse, particleGlow 10s ease-in-out infinite;
            filter: blur(20px) brightness(1.5) saturate(2);
        }

        /* Particella 5 - Verde Emerald */
        .particle-5 {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, 
                rgba(16, 185, 129, 0.4) 0%, 
                rgba(110, 231, 183, 0.22) 50%, 
                transparent 70%);
            top: 80%;
            right: 45%;
            animation: particleFloat5 22s ease-in-out infinite, particleGlow 18s ease-in-out infinite;
            filter: blur(16px) brightness(1.35) saturate(1.9);
        }

        /* Particella 6 - Giallo Solar */
        .particle-6 {
            width: 190px;
            height: 190px;
            background: radial-gradient(circle, 
                rgba(251, 191, 36, 0.32) 0%, 
                rgba(254, 240, 138, 0.16) 50%, 
                transparent 70%);
            top: 5%;
            left: 60%;
            animation: particleFloat6 30s ease-in-out infinite reverse, particleGlow 14s ease-in-out infinite;
            filter: blur(14px) brightness(1.45) saturate(2.2);
        }

        /* 🎭 DISTORSIONI OTTICHE E EFFETTI SPECIALI */
        .lava-lamp-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.05) 0%, transparent 30%),
                radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.03) 0%, transparent 25%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 40%);
            animation: opticalDistortion 45s ease-in-out infinite;
            pointer-events: none;
            mix-blend-mode: screen;
        }

        .lava-lamp-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                conic-gradient(from 0deg at 30% 70%, 
                    rgba(59, 130, 246, 0.08) 0deg, 
                    rgba(139, 92, 246, 0.06) 60deg,
                    rgba(236, 72, 153, 0.04) 120deg,
                    rgba(16, 185, 129, 0.05) 180deg,
                    rgba(251, 191, 36, 0.07) 240deg,
                    rgba(249, 115, 22, 0.06) 300deg,
                    rgba(59, 130, 246, 0.08) 360deg);
            animation: conicSpin 90s linear infinite, breathe 20s ease-in-out infinite;
            pointer-events: none;
            mix-blend-mode: multiply;
        }

        /* 🌟 ANIMAZIONI PARTICELLARI ULTRA-DINAMICHE */
        @keyframes particleFloat1 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.4;
            }
            25% { 
                transform: translate3d(150px, -80px, 10px) scale(1.3) rotate(90deg); 
                opacity: 0.7;
            }
            50% { 
                transform: translate3d(80px, 120px, -5px) scale(0.8) rotate(180deg); 
                opacity: 0.3;
            }
            75% { 
                transform: translate3d(-100px, 60px, 8px) scale(1.1) rotate(270deg); 
                opacity: 0.6;
            }
        }

        @keyframes particleFloat2 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.35;
            }
            33% { 
                transform: translate3d(-120px, -100px, 12px) scale(1.25) rotate(120deg); 
                opacity: 0.65;
            }
            66% { 
                transform: translate3d(-60px, 140px, -8px) scale(0.75) rotate(240deg); 
                opacity: 0.28;
            }
        }

        @keyframes particleFloat3 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.3;
            }
            50% { 
                transform: translate3d(200px, -150px, 15px) scale(1.4) rotate(180deg); 
                opacity: 0.75;
            }
        }

        @keyframes particleFloat4 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.38;
            }
            40% { 
                transform: translate3d(-150px, 100px, -10px) scale(1.2) rotate(144deg); 
                opacity: 0.68;
            }
            80% { 
                transform: translate3d(80, -120px, 6px) scale(0.9) rotate(288deg); 
                opacity: 0.32;
            }
        }

        @keyframes particleFloat5 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.4;
            }
            60% { 
                transform: translate3d(120px, 180px, -12px) scale(1.35) rotate(216deg); 
                opacity: 0.7;
            }
        }

        @keyframes particleFloat6 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.32;
            }
            30% { 
                transform: translate3d(-180px, -60px, 8px) scale(1.15) rotate(108deg); 
                opacity: 0.62;
            }
            70% { 
                transform: translate3d(90px, 140px, -6px) scale(0.85) rotate(252deg); 
                opacity: 0.28;
            }
        }

        @keyframes particleGlow {
            0%, 100% { 
                filter: blur(15px) brightness(1.3); 
            }
            50% { 
                filter: blur(25px) brightness(1.8) saturate(2.2); 
            }
        }

        @keyframes opticalDistortion {
            0%, 100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 1;
            }
            25% { 
                transform: scale(1.05) rotate(1deg); 
                opacity: 0.8;
            }
            50% { 
                transform: scale(0.95) rotate(-1deg); 
                opacity: 1.2;
            }
            75% { 
                transform: scale(1.02) rotate(0.5deg); 
                opacity: 0.9;
            }
        }

        @keyframes conicSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes breathe {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.6;
            }
            50% { 
                transform: scale(1.1); 
                opacity: 0.8;
            }
        }

        /* 🌟 SISTEMA DI INTERAZIONE AVANZATO */
        .lava-lamp-container:hover .lava-blob {
            animation-duration: 0.8s !important;
            filter: brightness(1.8) saturate(3.0) contrast(1.8) !important;
        }

        .lava-lamp-container:hover .particle {
            animation-duration: 1.2s !important;
            transform: scale(1.5) !important;
        }

        /* Effetti di profondità e parallax */
        .lava-blob:nth-child(1n) { z-index: -10; }
        .lava-blob:nth-child(2n) { z-index: -8; }
        .lava-blob:nth-child(3n) { z-index: -6; }
        .lava-blob:nth-child(4n) { z-index: -4; }
        .particle-system { z-index: -2; }

        /* Synchronization dinamica tra blob */
        @keyframes syncPulse {
            0%, 100% { 
                transform: scale(1); 
                filter: brightness(1.3) saturate(2.0);
            }
            50% { 
                transform: scale(1.15); 
                filter: brightness(1.7) saturate(2.8);
            }
        }

        /* Applicazione del sync pulse a intervalli */
        .blob-1:nth-child(8n+1) { animation: morphicFloat1 40s infinite, syncPulse 12s ease-in-out infinite; }
        .blob-2:nth-child(8n+2) { animation: morphicFloat2 52s infinite, syncPulse 15s ease-in-out infinite 2s; }
        .blob-3:nth-child(8n+3) { animation: morphicFloat3 63s infinite, syncPulse 18s ease-in-out infinite 4s; }
        .blob-4:nth-child(8n+4) { animation: morphicFloat4 71s infinite, syncPulse 14s ease-in-out infinite 6s; }
        .blob-5:nth-child(8n+5) { animation: morphicFloat5 84s infinite, syncPulse 16s ease-in-out infinite 8s; }
        .blob-6:nth-child(8n+6) { animation: morphicFloat6 58s infinite, syncPulse 13s ease-in-out infinite 10s; }
        .blob-7:nth-child(8n+7) { animation: morphicFloat7 76s infinite, syncPulse 17s ease-in-out infinite 12s; }
        .blob-8:nth-child(8n+8) { animation: morphicFloat8 69s infinite, syncPulse 19s ease-in-out infinite 14s; }

        /* Effetto wow finale - Aurora Borealis */
        .lava-lamp-container::before {
            background: 
                linear-gradient(45deg, 
                    rgba(59, 130, 246, 0.1) 0%, 
                    rgba(139, 92, 246, 0.08) 25%,
                    rgba(236, 72, 153, 0.06) 50%,
                    rgba(16, 185, 129, 0.08) 75%,
                    rgba(251, 191, 36, 0.1) 100%);
            animation: opticalDistortion 45s ease-in-out infinite,
                       auroraShift 60s linear infinite;
        }

        @keyframes auroraShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .lava-blob {
            position: absolute;
            border-radius: 50%;
            will-change: transform, filter, border-radius, background;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
            transition: all 2s cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* 🔄 MORPHING DINAMICO E INTERAZIONI */
        .lava-blob:nth-child(odd) {
            animation-delay: -3s;
            border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
        }

        .lava-blob:nth-child(even) {
            animation-delay: -7s;
            border-radius: 30% 70% 60% 40% / 40% 70% 30% 60%;
        }

        /* Morphing continuo delle forme */
        .blob-1, .blob-3, .blob-5, .blob-7 {
            animation: morphicFloat1 40s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite,
                       blobMorph1 15s ease-in-out infinite,
                       colorShift1 25s linear infinite;
        }

        .blob-2, .blob-4, .blob-6, .blob-8 {
            animation: morphicFloat2 52s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite reverse,
                       blobMorph2 18s ease-in-out infinite reverse,
                       colorShift2 30s linear infinite reverse;
        }

        /* Animazioni di morphing delle forme */
        @keyframes blobMorph1 {
            0%, 100% { 
                border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
                transform: perspective(1000px) rotateX(0deg) rotateY(0deg);
            }
            25% { 
                border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%;
                transform: perspective(1000px) rotateX(10deg) rotateY(-5deg);
            }
            50% { 
                border-radius: 70% 30% 60% 30% / 30% 40% 60% 70%;
                transform: perspective(1000px) rotateX(-8deg) rotateY(12deg);
            }
            75% { 
                border-radius: 40% 60% 40% 60% / 70% 50% 40% 50%;
                transform: perspective(1000px) rotateX(6deg) rotateY(-8deg);
            }
        }

        @keyframes blobMorph2 {
            0%, 100% { 
                border-radius: 30% 70% 60% 40% / 40% 70% 30% 60%;
                transform: perspective(800px) rotateZ(0deg);
            }
            33% { 
                border-radius: 60% 30% 40% 70% / 60% 40% 70% 30%;
                transform: perspective(800px) rotateZ(15deg);
            }
            66% { 
                border-radius: 50% 50% 30% 70% / 30% 60% 50% 50%;
                transform: perspective(800px) rotateZ(-12deg);
            }
        }

        /* Cambiamenti dinamici di colore */
        @keyframes colorShift1 {
            0% { filter: blur(35px) brightness(1.3) saturate(2) contrast(1.2) hue-rotate(0deg); }
            16.66% { filter: blur(28px) brightness(1.5) saturate(2.3) contrast(1.4) hue-rotate(60deg); }
            33.33% { filter: blur(45px) brightness(1.2) saturate(1.8) contrast(1.1) hue-rotate(120deg); }
            50% { filter: blur(32px) brightness(1.6) saturate(2.5) contrast(1.5) hue-rotate(180deg); }
            66.66% { filter: blur(38px) brightness(1.35) saturate(2.1) contrast(1.25) hue-rotate(240deg); }
            83.33% { filter: blur(41px) brightness(1.4) saturate(1.9) contrast(1.3) hue-rotate(300deg); }
            100% { filter: blur(35px) brightness(1.3) saturate(2) contrast(1.2) hue-rotate(360deg); }
        }

        @keyframes colorShift2 {
            0% { filter: blur(42px) brightness(1.4) saturate(2.2) contrast(1.3) hue-rotate(0deg); }
            20% { filter: blur(35px) brightness(1.6) saturate(2.6) contrast(1.6) hue-rotate(72deg); }
            40% { filter: blur(48px) brightness(1.25) saturate(1.9) contrast(1.1) hue-rotate(144deg); }
            60% { filter: blur(31px) brightness(1.7) saturate(2.8) contrast(1.7) hue-rotate(216deg); }
            80% { filter: blur(39px) brightness(1.3) saturate(2.1) contrast(1.2) hue-rotate(288deg); }
            100% { filter: blur(42px) brightness(1.4) saturate(2.2) contrast(1.3) hue-rotate(360deg); }
        }

        /* 🌊 SISTEMA LAVA LAMP SUPREMO - 8 BLOB ULTRA-AVANZATI */

        /* Blob Principale - Blu Cosmico Gigante */
        .blob-1 {
            width: 1200px;
            height: 1200px;
            background: 
                radial-gradient(ellipse 120% 80% at 30% 40%, rgba(59, 130, 246, 1) 0%, transparent 50%),
                radial-gradient(ellipse 80% 120% at 70% 60%, rgba(29, 78, 216, 0.9) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.8) 0%, rgba(139, 92, 246, 0.6) 40%, transparent 70%);
            top: -500px;
            left: -500px;
            animation: morphicFloat1 40s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
            filter: blur(35px) brightness(1.3) saturate(2) contrast(1.2);
        }

        /* Blob Viola Nebula Dinamico */
        .blob-2 {
            width: 1100px;
            height: 1100px;
            background: 
                radial-gradient(ellipse 90% 130% at 40% 30%, rgba(139, 92, 246, 1) 0%, transparent 60%),
                radial-gradient(ellipse 130% 90% at 60% 70%, rgba(88, 28, 135, 0.9) 0%, transparent 60%),
                radial-gradient(circle at 20% 80%, rgba(236, 72, 153, 0.8) 0%, rgba(219, 39, 119, 0.5) 50%, transparent 80%);
            top: 30%;
            right: -450px;
            animation: morphicFloat2 52s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite reverse;
            filter: blur(42px) brightness(1.4) saturate(2.2) contrast(1.3);
        }

        /* Blob Turchese Plasma Elettrico */
        .blob-3 {
            width: 950px;
            height: 950px;
            background: 
                radial-gradient(ellipse 110% 70% at 25% 35%, rgba(6, 182, 212, 1) 0%, transparent 55%),
                radial-gradient(ellipse 70% 110% at 75% 65%, rgba(8, 145, 178, 0.9) 0%, transparent 55%),
                radial-gradient(circle at 60% 40%, rgba(34, 197, 94, 0.8) 0%, rgba(16, 185, 129, 0.4) 60%, transparent 85%);
            bottom: -400px;
            left: 15%;
            animation: morphicFloat3 63s cubic-bezier(0.175, 0.885, 0.32, 1.275) infinite;
            filter: blur(38px) brightness(1.35) saturate(2.4) contrast(1.25);
        }

        /* Blob Arancione Lava Supernova */
        .blob-4 {
            width: 850px;
            height: 850px;
            background: 
                radial-gradient(ellipse 100% 80% at 35% 45%, rgba(249, 115, 22, 1) 0%, transparent 50%),
                radial-gradient(ellipse 80% 100% at 65% 55%, rgba(251, 146, 60, 0.9) 0%, transparent 50%),
                radial-gradient(circle at 50% 30%, rgba(254, 215, 170, 0.7) 0%, rgba(255, 237, 213, 0.3) 70%, transparent 90%);
            top: 15%;
            left: 65%;
            animation: morphicFloat4 71s cubic-bezier(0.23, 1, 0.32, 1) infinite;
            filter: blur(44px) brightness(1.5) saturate(2.6) contrast(1.4);
        }

        /* Blob Rosa Neon Hyperdimensionale */
        .blob-5 {
            width: 750px;
            height: 750px;
            background: 
                radial-gradient(ellipse 85% 115% at 40% 30%, rgba(236, 72, 153, 1) 0%, transparent 60%),
                radial-gradient(ellipse 115% 85% at 60% 70%, rgba(219, 39, 119, 0.9) 0%, transparent 60%),
                radial-gradient(circle at 30% 60%, rgba(190, 24, 93, 0.7) 0%, rgba(157, 23, 77, 0.3) 80%, transparent 95%);
            bottom: 5%;
            right: 15%;
            animation: morphicFloat5 84s cubic-bezier(0.445, 0.05, 0.55, 0.95) infinite reverse;
            filter: blur(41px) brightness(1.45) saturate(2.8) contrast(1.35);
        }

        /* Blob Verde Smeraldo Quantico */
        .blob-6 {
            width: 900px;
            height: 900px;
            background: 
                radial-gradient(ellipse 95% 105% at 45% 25%, rgba(16, 185, 129, 1) 0%, transparent 55%),
                radial-gradient(ellipse 105% 95% at 55% 75%, rgba(34, 197, 94, 0.9) 0%, transparent 55%),
                radial-gradient(circle at 70% 50%, rgba(5, 150, 105, 0.8) 0%, rgba(6, 120, 85, 0.4) 65%, transparent 88%);
            top: 60%;
            left: -200px;
            animation: morphicFloat6 58s cubic-bezier(0.86, 0, 0.07, 1) infinite;
            filter: blur(39px) brightness(1.38) saturate(2.5) contrast(1.28);
        }

        /* Blob Giallo Sole Cosmico */
        .blob-7 {
            width: 800px;
            height: 800px;
            background: 
                radial-gradient(ellipse 110% 90% at 35% 40%, rgba(254, 240, 138, 1) 0%, transparent 50%),
                radial-gradient(ellipse 90% 110% at 65% 60%, rgba(251, 191, 36, 0.9) 0%, transparent 50%),
                radial-gradient(circle at 50% 70%, rgba(245, 158, 11, 0.8) 0%, rgba(217, 119, 6, 0.4) 75%, transparent 92%);
            top: -100px;
            right: 25%;
            animation: morphicFloat7 76s cubic-bezier(0.19, 1, 0.22, 1) infinite reverse;
            filter: blur(43px) brightness(1.42) saturate(2.3) contrast(1.32);
        }

        /* Blob Indaco Galassia Profonda */
        .blob-8 {
            width: 1000px;
            height: 1000px;
            background: 
                radial-gradient(ellipse 120% 80% at 30% 50%, rgba(79, 70, 229, 1) 0%, transparent 58%),
                radial-gradient(ellipse 80% 120% at 70% 50%, rgba(67, 56, 202, 0.9) 0%, transparent 58%),
                radial-gradient(circle at 45% 30%, rgba(99, 102, 241, 0.8) 0%, rgba(124, 58, 237, 0.5) 70%, transparent 90%);
            bottom: 20%;
            left: 60%;
            animation: morphicFloat8 69s cubic-bezier(0.37, 0, 0.63, 1) infinite;
            filter: blur(36px) brightness(1.32) saturate(2.1) contrast(1.22);
        }

        /* 🎪 ANIMAZIONI MORFICHE ULTRA-COMPLESSE */

        /* Blob 1 - Movimento Cosmico Tridimensionale */
        @keyframes morphicFloat1 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg) skewX(0deg) skewY(0deg); 
                opacity: 1;
                filter: blur(35px) brightness(1.3) saturate(2) contrast(1.2) hue-rotate(0deg);
            }
            12.5% { 
                transform: translate3d(180px, -120px, 20px) scale(1.25) rotate(45deg) skewX(5deg) skewY(-3deg); 
                opacity: 0.85;
                filter: blur(28px) brightness(1.5) saturate(2.3) contrast(1.4) hue-rotate(15deg);
            }
            25% { 
                transform: translate3d(320px, 80px, -15px) scale(0.75) rotate(90deg) skewX(-8deg) skewY(6deg); 
                opacity: 0.9;
                filter: blur(45px) brightness(1.2) saturate(1.8) contrast(1.1) hue-rotate(30deg);
            }
            37.5% { 
                transform: translate3d(200px, 300px, 25px) scale(1.45) rotate(135deg) skewX(3deg) skewY(-9deg); 
                opacity: 0.7;
                filter: blur(32px) brightness(1.6) saturate(2.5) contrast(1.5) hue-rotate(45deg);
            }
            50% { 
                transform: translate3d(-80px, 250px, 0px) scale(1.1) rotate(180deg) skewX(-12deg) skewY(4deg); 
                opacity: 0.95;
                filter: blur(38px) brightness(1.35) saturate(2.1) contrast(1.25) hue-rotate(60deg);
            }
            62.5% { 
                transform: translate3d(-250px, 100px, -30px) scale(0.9) rotate(225deg) skewX(7deg) skewY(-2deg); 
                opacity: 0.8;
                filter: blur(41px) brightness(1.4) saturate(1.9) contrast(1.3) hue-rotate(75deg);
            }
            75% { 
                transform: translate3d(-180px, -150px, 18px) scale(1.3) rotate(270deg) skewX(-5deg) skewY(8deg); 
                opacity: 0.88;
                filter: blur(33px) brightness(1.25) saturate(2.2) contrast(1.15) hue-rotate(90deg);
            }
            87.5% { 
                transform: translate3d(50px, -200px, -10px) scale(1.15) rotate(315deg) skewX(10deg) skewY(-6deg); 
                opacity: 0.92;
                filter: blur(29px) brightness(1.45) saturate(2.4) contrast(1.45) hue-rotate(105deg);
            }
        }

        /* Blob 2 - Nebula Hiperdimensionale */
        @keyframes morphicFloat2 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg) skewX(0deg) skewY(0deg); 
                opacity: 0.95;
                filter: blur(42px) brightness(1.4) saturate(2.2) contrast(1.3) hue-rotate(0deg);
            }
            15% { 
                transform: translate3d(-140px, -90px, 35px) scale(1.35) rotate(54deg) skewX(6deg) skewY(-4deg); 
                opacity: 1;
                filter: blur(35px) brightness(1.6) saturate(2.6) contrast(1.6) hue-rotate(20deg);
            }
            30% { 
                transform: translate3d(-280px, 120px, -20px) scale(0.65) rotate(108deg) skewX(-10deg) skewY(7deg); 
                opacity: 0.6;
                filter: blur(48px) brightness(1.25) saturate(1.9) contrast(1.1) hue-rotate(40deg);
            }
            45% { 
                transform: translate3d(-200px, 320px, 28px) scale(1.55) rotate(162deg) skewX(4deg) skewY(-11deg); 
                opacity: 0.8;
                filter: blur(31px) brightness(1.7) saturate(2.8) contrast(1.7) hue-rotate(60deg);
            }
            60% { 
                transform: translate3d(60px, 280px, -25px) scale(0.85) rotate(216deg) skewX(-8deg) skewY(5deg); 
                opacity: 0.9;
                filter: blur(39px) brightness(1.3) saturate(2.1) contrast(1.2) hue-rotate(80deg);
            }
            75% { 
                transform: translate3d(200px, 80px, 15px) scale(1.25) rotate(270deg) skewX(9deg) skewY(-3deg); 
                opacity: 0.75;
                filter: blur(36px) brightness(1.5) saturate(2.4) contrast(1.4) hue-rotate(100deg);
            }
            90% { 
                transform: translate3d(80px, -120px, -12px) scale(1.05) rotate(324deg) skewX(-6deg) skewY(8deg); 
                opacity: 0.85;
                filter: blur(44px) brightness(1.35) saturate(2.0) contrast(1.25) hue-rotate(120deg);
            }
        }

        /* Blob 3-8 - Movimenti Quantici Complessi */
        @keyframes morphicFloat3 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg) rotateX(0deg) rotateY(0deg); 
                opacity: 0.9;
                filter: blur(38px) brightness(1.35) saturate(2.4) contrast(1.25) hue-rotate(0deg);
            }
            20% { 
                transform: translate3d(-220px, -180px, 40px) scale(1.4) rotate(72deg) rotateX(15deg) rotateY(-10deg); 
                opacity: 1;
                filter: blur(30px) brightness(1.55) saturate(2.7) contrast(1.55) hue-rotate(25deg);
            }
            40% { 
                transform: translate3d(-380px, 150px, -30px) scale(0.6) rotate(144deg) rotateX(-20deg) rotateY(18deg); 
                opacity: 0.65;
                filter: blur(46px) brightness(1.2) saturate(1.8) contrast(1.05) hue-rotate(50deg);
            }
            60% { 
                transform: translate3d(-150px, 380px, 22px) scale(1.6) rotate(216deg) rotateX(12deg) rotateY(-15deg); 
                opacity: 0.8;
                filter: blur(33px) brightness(1.65) saturate(2.9) contrast(1.65) hue-rotate(75deg);
            }
            80% { 
                transform: translate3d(80px, 200px, -18px) scale(0.95) rotate(288deg) rotateX(-8deg) rotateY(12deg); 
                opacity: 0.88;
                filter: blur(40px) brightness(1.3) saturate(2.2) contrast(1.2) hue-rotate(100deg);
            }
        }

        @keyframes morphicFloat4 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg) perspective(1000px) rotateZ(0deg); 
                opacity: 0.85;
                filter: blur(44px) brightness(1.5) saturate(2.6) contrast(1.4) hue-rotate(0deg);
            }
            25% { 
                transform: translate3d(-120px, 180px, -35px) scale(1.3) rotate(90deg) perspective(800px) rotateZ(25deg); 
                opacity: 1;
                filter: blur(37px) brightness(1.7) saturate(3.0) contrast(1.7) hue-rotate(30deg);
            }
            50% { 
                transform: translate3d(-320px, -100px, 25px) scale(0.7) rotate(180deg) perspective(1200px) rotateZ(-20deg); 
                opacity: 0.7;
                filter: blur(51px) brightness(1.25) saturate(2.0) contrast(1.1) hue-rotate(60deg);
            }
            75% { 
                transform: translate3d(-80px, -280px, 15px) scale(1.45) rotate(270deg) perspective(900px) rotateZ(35deg); 
                opacity: 0.9;
                filter: blur(32px) brightness(1.6) saturate(2.8) contrast(1.6) hue-rotate(90deg);
            }
        }

        @keyframes morphicFloat5 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg) matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1); 
                opacity: 0.8;
                filter: blur(41px) brightness(1.45) saturate(2.8) contrast(1.35) hue-rotate(0deg);
            }
            33% { 
                transform: translate3d(150px, -160px, 30px) scale(1.25) rotate(120deg) matrix3d(1.1,0.1,0,0,-0.1,1.1,0,0,0,0,1,0,0,0,0,1); 
                opacity: 0.95;
                filter: blur(34px) brightness(1.65) saturate(3.2) contrast(1.65) hue-rotate(40deg);
            }
            66% { 
                transform: translate3d(-180px, 220px, -20px) scale(0.8) rotate(240deg) matrix3d(0.9,-0.1,0,0,0.1,0.9,0,0,0,0,1,0,0,0,0,1); 
                opacity: 0.75;
                filter: blur(47px) brightness(1.3) saturate(2.1) contrast(1.15) hue-rotate(80deg);
            }
        }

        @keyframes morphicFloat6 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.88;
                filter: blur(39px) brightness(1.38) saturate(2.5) contrast(1.28) hue-rotate(0deg);
            }
            50% { 
                transform: translate3d(280px, -220px, 0px) scale(1.35) rotate(180deg); 
                opacity: 1;
                filter: blur(31px) brightness(1.6) saturate(2.9) contrast(1.6) hue-rotate(90deg);
            }
        }

        @keyframes morphicFloat7 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.82;
                filter: blur(43px) brightness(1.42) saturate(2.3) contrast(1.32) hue-rotate(0deg);
            }
            40% { 
                transform: translate3d(-200px, 180px, 0px) scale(1.4) rotate(144deg); 
                opacity: 0.95;
                filter: blur(35px) brightness(1.65) saturate(2.8) contrast(1.65) hue-rotate(60deg);
            }
            80% { 
                transform: translate3d(120px, -150px, 0px) scale(0.9) rotate(288deg); 
                opacity: 0.78;
                filter: blur(48px) brightness(1.3) saturate(2.0) contrast(1.2) hue-rotate(120deg);
            }
        }

        @keyframes morphicFloat8 {
            0%, 100% { 
                transform: translate3d(0, 0, 0) scale(1) rotate(0deg); 
                opacity: 0.86;
                filter: blur(36px) brightness(1.32) saturate(2.1) contrast(1.22) hue-rotate(0deg);
            }
            30% { 
                transform: translate3d(-180px, -140px, 0px) scale(1.3) rotate(108deg); 
                opacity: 1;
                filter: blur(28px) brightness(1.55) saturate(2.6) contrast(1.55) hue-rotate(45deg);
            }
            70% { 
                transform: translate3d(220px, 160px, 0px) scale(0.8) rotate(252deg); 
                opacity: 0.75;
                filter: blur(44px) brightness(1.25) saturate(1.9) contrast(1.1) hue-rotate(90deg);
            }
        }









        /* 🎵 PULSAZIONI ORGANICHE CON SUONI VIRTUALI */
        @keyframes pulse-glow {
            0%, 100% { 
                filter: blur(8px) contrast(1.3) saturate(1.4) brightness(1) hue-rotate(0deg);
                transform: scale(1);
            }
            25% { 
                filter: blur(12px) contrast(1.5) saturate(1.6) brightness(1.1) hue-rotate(10deg);
                transform: scale(1.03);
            }
            50% { 
                filter: blur(6px) contrast(1.2) saturate(1.3) brightness(0.95) hue-rotate(20deg);
                transform: scale(0.98);
            }
            75% { 
                filter: blur(10px) contrast(1.4) saturate(1.5) brightness(1.05) hue-rotate(15deg);
                transform: scale(1.01);
            }
        }
        }

        .blob-1 { animation: float-1 25s infinite, pulse-glow 8s infinite; }
        .blob-2 { animation: float-2 30s infinite, pulse-glow 12s infinite; }
        .blob-3 { animation: float-3 35s infinite, pulse-glow 10s infinite; }
        .blob-4 { animation: float-4 28s infinite, pulse-glow 9s infinite; }
        .blob-5 { animation: float-5 32s infinite, pulse-glow 11s infinite; }

        /* Overlay per migliorare leggibilità */
        .content-overlay {
            position: relative;
            z-index: 1;
            background: rgba(248, 250, 252, 0.05);
            backdrop-filter: blur(1px);
            min-height: 100vh;
        }

        /* Miglioramento contrasto per tutti i dispositivi */
        .header-section {
            position: relative;
            z-index: 50;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.95) 0%, rgba(59, 130, 246, 0.95) 100%);
            backdrop-filter: blur(12px) saturate(1.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        /* Form moderni ultra-professionali */
        .form-section {
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(55px) saturate(260%) brightness(1.25);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 28px;
            box-shadow: 
                0 20px 80px rgba(0, 0, 0, 0.12),
                0 8px 40px rgba(0, 0, 0, 0.08),
                inset 0 2px 0 rgba(255, 255, 255, 0.15);
            position: relative;
            z-index: 15;
            padding: 32px;
        }

        /* Sezione transazioni ultra-trasparente mobile */
        .transactions-section {
            background: rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(45px) saturate(220%) brightness(1.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            position: relative;
            z-index: 12;
        }

        /* TITOLO ROSA ACCESO CON OMBRE SCURE */
        .title-bg {
            background: linear-gradient(135deg, #f472b6, #ec4899, #be185d);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent !important;
            text-shadow: none;
            position: relative;
            display: inline-block;
            padding: 8px 20px;
            border-radius: 12px;
            background: linear-gradient(135deg, #f472b6 0%, #ec4899 50%, #be185d 100%);
            color: white !important;
            box-shadow: 
                0 8px 25px rgba(190, 24, 93, 0.4),
                0 4px 15px rgba(236, 72, 153, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.2);
        }



        /* Effetti hover per titoli */
        .title-bg:hover {
            transform: translateY(-1px);
            box-shadow: 
                0 12px 35px rgba(190, 24, 93, 0.5),
                0 6px 20px rgba(236, 72, 153, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }



        /* LAVA LAMP ROSA - EFFETTO BOLLE SEMPLICE E FLUIDO */


        /* 🌈 LOGO SAPO TRACKER ANIMATO E COLORATO */
        .animated-logo {
            font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1.75rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            background: linear-gradient(-45deg, 
                #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, 
                #feca57, #ff9ff3, #54a0ff, #5f27cd,
                #00d2d3, #ff9757, #c44569, #f8b500);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowFlow 8s linear infinite;
            text-shadow: 
                0 0 30px rgba(255, 107, 107, 0.5),
                0 0 60px rgba(78, 205, 196, 0.3),
                0 0 90px rgba(69, 183, 209, 0.2);
            position: relative;
            display: inline-block;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .animated-logo::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(-45deg, 
                rgba(255, 107, 107, 0.2), rgba(78, 205, 196, 0.2), 
                rgba(69, 183, 209, 0.2), rgba(150, 206, 180, 0.2));
            background-size: 400% 400%;
            border-radius: 16px;
            z-index: -1;
            animation: rainbowBorder 8s linear infinite;
            backdrop-filter: blur(20px) saturate(150%);
        }

        .animated-logo:hover {
            transform: translateY(-3px) scale(1.05);
            animation-duration: 4s;
        }

        .animated-logo:hover::before {
            animation-duration: 4s;
        }

        /* Animazioni colorate professionali - movimento verso DESTRA */
        @keyframes rainbowFlow {
            0% { 
                background-position: 100% 50%;
                text-shadow: 
                    0 0 25px rgba(84, 160, 255, 0.6),
                    0 0 50px rgba(84, 160, 255, 0.4);
            }
            16.66% { 
                background-position: 83.33% 50%;
                text-shadow: 
                    0 0 25px rgba(255, 159, 243, 0.6),
                    0 0 50px rgba(255, 159, 243, 0.4);
            }
            33.33% { 
                background-position: 66.66% 50%;
                text-shadow: 
                    0 0 25px rgba(254, 202, 87, 0.6),
                    0 0 50px rgba(254, 202, 87, 0.4);
            }
            50% { 
                background-position: 50% 50%;
                text-shadow: 
                    0 0 25px rgba(150, 206, 180, 0.6),
                    0 0 50px rgba(150, 206, 180, 0.4);
            }
            66.66% { 
                background-position: 33.33% 50%;
                text-shadow: 
                    0 0 25px rgba(69, 183, 209, 0.6),
                    0 0 50px rgba(69, 183, 209, 0.4);
            }
            83.33% { 
                background-position: 16.66% 50%;
                text-shadow: 
                    0 0 25px rgba(78, 205, 196, 0.6),
                    0 0 50px rgba(78, 205, 196, 0.4);
            }
            100% { 
                background-position: 0% 50%;
                text-shadow: 
                    0 0 25px rgba(255, 107, 107, 0.6),
                    0 0 50px rgba(255, 107, 107, 0.4);
            }
        }

        @keyframes rainbowBorder {
            0% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Particelle animate di sfondo */
        .animated-logo::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, 
                rgba(255, 107, 107, 0.3) 0%, 
                rgba(78, 205, 196, 0.2) 50%, 
                transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 3s ease-in-out infinite;
            z-index: -2;
            pointer-events: none;
        }

        @keyframes pulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0.5;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0.8;
            }
        }


        
        .header-bg {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.95) 0%, rgba(59, 130, 246, 0.95) 100%);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* 💎 CARTE TRASPARENTI MA LEGGIBILI */
        .card {
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(50px) saturate(220%) brightness(1.2);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            padding: 28px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 
                0 15px 70px rgba(0, 0, 0, 0.1),
                0 6px 30px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .card:hover {
            background: rgba(0, 0, 0, 0.22);
            border: 1px solid rgba(255, 255, 255, 0.35);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 25px 90px rgba(0, 0, 0, 0.15),
                0 10px 50px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .chart-container {
            position: relative;
            height: 600px;
            width: 100%;
            margin: 24px 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(55px) saturate(260%) brightness(1.18);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 
                0 15px 70px rgba(0, 0, 0, 0.08),
                0 6px 35px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
            padding: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
        }



        .chart-container canvas {
            transition: transform 0.3s ease-out;
            display: block;
            margin: 0 auto;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.3));
        }

        .chart-container canvas.animating {
            filter: drop-shadow(0 0 30px rgba(59, 130, 246, 0.5));
        }

        /* Tasti Rapidi Spese */
        .quick-expense-btn {
            background: rgba(0, 0, 0, 0.12);
            backdrop-filter: blur(45px) saturate(220%) brightness(1.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 22px 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 40px rgba(0, 0, 0, 0.08),
                0 4px 20px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }

        .quick-expense-btn:hover {
            background: rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                0 12px 50px rgba(0, 0, 0, 0.08),
                0 4px 20px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }

        .quick-expense-btn:active {
            transform: translateY(0);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .quick-expense-btn .emoji {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2));
            transition: all 0.3s ease;
        }

        .quick-expense-btn:hover .emoji {
            transform: scale(1.1);
            filter: drop-shadow(0 4px 15px rgba(0, 0, 0, 0.3));
        }

        .quick-expense-btn .category {
            font-weight: 600;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 6px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.02em;
        }

        .quick-expense-btn .amount {
            font-weight: 800;
            font-size: 15px;
            color: rgba(239, 68, 68, 1);
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            letter-spacing: -0.01em;
        }

        .quick-expense-btn.pulsing {
            animation: quickPulse 0.6s ease-out;
        }

        @keyframes quickPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
            100% { transform: scale(1); }
        }

        /* Assicura che non ci siano tagli durante l'animazione */
        .chart-container > div {
            overflow: visible !important;
            transform-origin: center center;
        }

        /* 📱 MOBILE PERFORMANCE OTTIMIZZATO - DISABILITA ANIMAZIONI PESANTI */
        @media (max-width: 768px) {
            /* 🚀 PERFORMANCE: Disabilita completamente lava lamp su mobile */
            .lava-lamp-container {
                display: none !important;
            }
            
            /* 🎨 Background semplice e leggero per mobile */
            body {
                background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%) !important;
                position: relative !important;
            }
            
            /* Overlay semplificato senza effetti */
            .content-overlay {
                background: rgba(0, 0, 0, 0.02) !important;
                backdrop-filter: none !important;
                min-height: 100vh;
            }
            
            /* 🚀 DISABILITA TUTTE LE ANIMAZIONI PESANTI */
            *, *::before, *::after {
                animation-duration: 0s !important;
                animation-delay: 0s !important;
                animation-iteration-count: 1 !important;
                background-attachment: scroll !important;
                scroll-behavior: auto !important;
                transition-duration: 0s !important;
            }
            
            /* Disabilita particelle */
            .particle-system,
            .particle,
            .lava-blob {
                display: none !important;
            }
            /* 🚀 Header mobile ottimizzato */
            .header-bg {
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;
                backdrop-filter: none !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2) !important;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2) !important;
                position: relative;
                z-index: 100;
            }

            /* Container contenuti mobile */
            .content-overlay {
                background: rgba(248, 250, 252, 0.08);
                backdrop-filter: blur(2px);
                z-index: 2;
            }

            /* 🚀 Cards semplificate per performance mobile */
            .card {
                background: rgba(30, 41, 59, 0.8) !important;
                backdrop-filter: none !important;
                border: 1px solid rgba(71, 85, 105, 0.5) !important;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
                position: relative;
                z-index: 10;
                border-radius: 16px !important;
            }

            /* 🚀 Chart container semplificato per mobile */
            .chart-container {
                padding: 20px 15px;
                height: 400px;
                background: rgba(30, 41, 59, 0.6) !important;
                backdrop-filter: none !important;
                border: 1px solid rgba(71, 85, 105, 0.4) !important;
                position: relative;
                z-index: 10;
                border-radius: 12px !important;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
            }

            /* Tasti rapidi mobile */
            .quick-expense-btn {
                padding: 12px 8px !important;
                border-radius: 10px !important;
            }

            .quick-expense-btn .emoji {
                font-size: 20px !important;
                margin-bottom: 6px !important;
            }

            .quick-expense-btn .category {
                font-size: 12px !important;
            }

            .quick-expense-btn .amount {
                font-size: 13px !important;
            }

            /* Grid su mobile - 2 colonne invece di 5 */
            #quick-expense-buttons {
                grid-template-columns: repeat(2, 1fr) !important;
            }


            
            .chart-container > div {
                width: 280px !important;
                height: 280px !important;
            }

            /* Blob mobile - ridotti e meno invadenti */
            .blob-1 { 
                width: 280px; height: 300px; 
                opacity: 0.7;
                top: 10%;
                left: -15%;
            }
            .blob-2 { 
                width: 200px; height: 220px; 
                opacity: 0.65;
                top: 60%;
                right: -20%;
            }
            .blob-3 { 
                width: 160px; height: 180px; 
                opacity: 0.6;
                bottom: 10%;
                left: 10%;
            }
            .blob-4 { 
                width: 140px; height: 150px; 
                opacity: 0.55;
                top: 5%;
                right: 40%;
            }
            .blob-5 { 
                width: 120px; height: 130px; 
                opacity: 0.5;
                bottom: 30%;
                right: -10%;
            }

            /* Bottoni mobile più accessibili */
            button {
                min-height: 48px;
                font-size: 16px;
                font-weight: 600;
                position: relative;
                z-index: 20;
                background: rgba(59, 130, 246, 0.95) !important;
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255, 255, 255, 0.3);
                box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
                touch-action: manipulation;
            }

            button:hover, button:focus, button:active {
                background: rgba(30, 64, 175, 0.98) !important;
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
                outline: 2px solid rgba(255, 255, 255, 0.5);
                outline-offset: 2px;
            }

            /* Bottoni Entrata e Uscita */
            .compact-btn {
                z-index: 100;
                font-weight: 600;
                text-shadow: none;
                min-width: 100px;
                min-height: 40px;
                font-size: 14px;
                padding: 8px 16px !important;
                border-radius: 8px !important;
                border: none !important;
            }

            .compact-btn:hover, .compact-btn:active, .compact-btn:focus {
                transform: translateY(-2px) scale(1.05);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
                outline: none;
            }

            /* 🚀 Input ultra-contrastati per mobile */
            input, select, textarea {
                background: #2d3748 !important;
                backdrop-filter: none !important;
                border: 2px solid #4a5568 !important;
                border-radius: 8px !important;
                color: #ffffff !important;
                position: relative;
                z-index: 15;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
                font-size: 16px;
                min-height: 44px;
                font-weight: 500 !important;
            }
            
            /* 🎯 FOCUS STATE ULTRA-VISIBILE */
            input:focus, select:focus, textarea:focus {
                background: #374151 !important;
                border-color: #60a5fa !important;
                color: #ffffff !important;
                box-shadow: 
                    0 0 0 3px rgba(96, 165, 250, 0.3) !important,
                    0 4px 12px rgba(0, 0, 0, 0.4) !important;
                outline: none !important;
            }
            
            /* 🎨 PLACEHOLDER VISIBILE */
            input::placeholder,
            select::placeholder,
            textarea::placeholder {
                color: #9ca3af !important;
                font-weight: 400 !important;
                opacity: 0.8 !important;
            }

            /* Titolo principale mobile */
            h1 {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                position: relative;
                z-index: 25;
                font-weight: 700;
                letter-spacing: -0.5px;
            }

            /* Statistiche mobile più leggibili */
            .text-center p, .text-center h3 {
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
                position: relative;
                z-index: 15;
            }

            /* Animazioni più calme su mobile */
            .lava-blob {
                filter: blur(4px) contrast(1.1) saturate(1.1);
                animation-duration: 40s, 15s !important;
            }

            /* Header mobile layout verticale */
            .header-section .container > div {
                flex-direction: column;
                space-y: 3;
            }

            /* Bottoni mobile compatti e accessibili */
            .compact-btn {
                min-width: 90px !important;
                min-height: 44px !important;
                font-size: 14px !important;
                font-weight: 700 !important;
                padding: 10px 16px !important;
                border-radius: 12px !important;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
                margin: 8px 0 !important;
            }

            .compact-btn:active {
                transform: translateY(0) scale(0.98) !important;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
                transition: all 0.1s ease !important;
            }

            /* 🚀 MOBILE ANTI-CRASH: Rimuovi pseudo-elementi pesanti */
            .compact-btn::after,
            .compact-btn::before,
            button::after,
            button::before {
                display: none !important;
            }
            
            /* 🔋 BATTERY SAVER: Disabilita transform e filter (eccetto modal) */
            *:not([id$="-modal"]):not([id$="-modal"] > div) {
                transform: none !important;
                filter: none !important;
                will-change: auto !important;
            }
            
            /* 🚀 GPU OPTIMIZATION: Forza rendering software */
            .chart-container canvas,
            canvas {
                transform: translateZ(0);
                backface-visibility: hidden;
                perspective: 1000;
            }
        }

        @media (max-width: 480px) {
            .chart-container {
                padding: 60px 30px;
                height: 500px;
            }
            
            .chart-container > div {
                width: 280px !important;
                height: 280px !important;
            }

            /* Blob ancora più piccoli per mobile */
            .blob-1 { width: 200px; height: 200px; }
            .blob-2 { width: 160px; height: 180px; }
            .blob-3 { width: 120px; height: 140px; }
            .blob-4 { width: 100px; height: 120px; }
            .blob-5 { width: 80px; height: 100px; }

            /* Header compatto per schermi molto piccoli */
            .header-section .container {
                padding: 16px 20px;
            }

            .compact-btn {
                min-width: 80px !important;
                font-size: 13px !important;
                padding: 8px 14px !important;
            }

            /* Titoli rosa mobile ottimizzati */
            .title-bg {
                font-size: 1.5rem !important;
                padding: 6px 16px !important;
                border-radius: 10px !important;
                box-shadow: 
                    0 6px 20px rgba(190, 24, 93, 0.5),
                    0 3px 12px rgba(236, 72, 153, 0.4),
                    inset 0 2px 4px rgba(255, 255, 255, 0.25);
            }



            #header-balance {
                font-size: 1.5rem !important;
            }

            /* Container titoli mobile */
            .title-section {
                text-align: center;
            }

            /* Lava Lamp Rosa mobile perfettamente fluida */
            .title-bg {
                animation-duration: 40s !important;
            }

            .title-bg:hover {
                animation-duration: 25s !important;
            }
        }

        /* Effetto parallax leggero */
        @media (prefers-reduced-motion: no-preference) {
            .lava-blob {
                will-change: transform;
                transform-style: preserve-3d;
            }
        }

        /* Disabilita animazioni se richiesto */
        @media (prefers-reduced-motion: reduce) {
            .lava-blob {
                animation: none;
            }
        }
        
        .professional-circle {
            position: relative;
        }
        
        .professional-circle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            border: 8px solid #e2e8f0;
            border-top: 8px solid #3b82f6;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: professionalSpin 2s linear infinite;
        }
        
        .professional-circle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 160px;
            height: 160px;
            border: 4px solid #f1f5f9;
            border-top: 4px solid #60a5fa;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: professionalSpin 3s linear infinite reverse;
        }
        
        @keyframes professionalSpin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .transaction-card {
            transition: all 0.2s ease;
            border: 1px solid #e2e8f0;
        }
        
        .transaction-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-color: #cbd5e1;
        }
        
        .btn-primary {
            background: #3b82f6;
            border: 1px solid #3b82f6;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            border-color: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(15, 23, 42, 0.9);
            z-index: 1000;
        }
        
        /* 🎨 STILI PROFESSIONALI PER BOTTONI */
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border: none !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3) !important;
        }
        
        .btn-success:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4) !important;
        }
        
        .btn-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
            border: none !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3) !important;
        }
        
        .btn-error:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4) !important;
        }
        
        /* 💰 CARD PROFESSIONALI */
        .professional-card {
            background: rgba(255, 255, 255, 0.03) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px) !important;
            border-radius: 16px !important;
            transition: all 0.3s ease !important;
        }
        
        .professional-card:hover {
            background: rgba(255, 255, 255, 0.05) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
        }
        
        /* 📱 MOBILE: Interfaccia ottimizzata per touch */
        @media (max-width: 768px) {
            /* Input e controlli più grandi */
            input, select, textarea, button {
                font-size: 16px !important; /* Previene zoom su iOS */
                padding: 14px 18px !important;
                border-radius: 12px !important;
                min-height: 48px !important; /* Touch target iOS guidelines */
            }
            
            .professional-card {
                margin: 8px !important;
                padding: 20px !important;
            }
            
            /* Testi più leggibili */
            h1 { font-size: 28px !important; }
            h2 { font-size: 24px !important; }
            h3 { font-size: 20px !important; }
            h4 { font-size: 18px !important; }
            p, span, div { font-size: 16px !important; line-height: 1.6 !important; }
            
            /* Bottoni più grandi e spaziati */
            .btn, button {
                min-height: 48px !important;
                padding: 14px 20px !important;
                font-size: 16px !important;
                font-weight: 600 !important;
                margin: 4px !important;
            }
            
            /* Icone più grandi */
            i.fas, i.fa {
                font-size: 18px !important;
            }
            
            /* Stat cards ottimizzate */
            .stat-card {
                padding: 20px 16px !important;
                margin-bottom: 16px !important;
            }
            
            .stat-card p {
                font-size: 14px !important;
                margin-bottom: 8px !important;
            }
            
            .stat-card .text-2xl {
                font-size: 24px !important;
                font-weight: 700 !important;
            }
            
            /* Bottoni mobile ottimizzati */
            .mobile-btn {
                width: 100% !important;
                justify-content: center !important;
                font-size: 16px !important;
                font-weight: 600 !important;
                padding: 16px 20px !important;
                margin: 8px 0 !important;
            }
            
            /* Layout chart headers mobile */
            .flex.justify-between {
                flex-direction: column !important;
                gap: 16px !important;
                align-items: stretch !important;
            }
            
            .flex.justify-between .flex.items-center {
                justify-content: center !important;
                text-align: center !important;
            }
            
            /* Grid responsive per quick expense buttons */
            .grid.grid-cols-2.md\:grid-cols-5 {
                grid-template-columns: 1fr 1fr !important;
                gap: 12px !important;
            }
            
            /* Stats cards mobile grid - 2x2 più leggibile */
            .stats-mobile-grid {
                grid-template-columns: 1fr 1fr !important;
                gap: 12px !important;
                margin-bottom: 24px !important;
            }
            
            /* Chart legends mobile */
            #chart-legend,
            #investment-chart-legend,
            #material-investment-chart-legend {
                font-size: 14px !important;
                padding: 16px 8px !important;
            }
            
            #chart-legend > div,
            #investment-chart-legend > div,
            #material-investment-chart-legend > div {
                padding: 12px !important;
                margin-bottom: 8px !important;
                border-radius: 8px !important;
                background: rgba(255, 255, 255, 0.05) !important;
            }
            
            /* Mobile header ottimizzazioni */
            .mobile-header {
                flex-direction: column !important;
                gap: 12px !important;
                align-items: stretch !important;
            }
            
            .mobile-title {
                text-align: center !important;
                font-size: 18px !important;
                font-weight: 700 !important;
            }
            
            .mobile-select {
                width: 100% !important;
                font-size: 16px !important;
                padding: 14px 16px !important;
                text-align: center !important;
            }
            
            /* Lista transazioni mobile */
            #transactions-list {
                max-height: none !important; /* Rimuovi limite altezza su mobile */
                padding: 0 8px !important;
            }
            
            /* Elementi transazione mobile */
            .transaction-item {
                padding: 16px !important;
                margin-bottom: 12px !important;
                border-radius: 12px !important;
                background: rgba(255, 255, 255, 0.08) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
            }
            
            /* Bottoni azioni principali mobile */
            .main-actions-mobile {
                flex-direction: column !important;
                gap: 16px !important;
                padding: 0 20px !important;
            }
            
            .main-btn-mobile {
                width: 100% !important;
                justify-content: center !important;
                font-size: 18px !important;
                font-weight: 700 !important;
                min-height: 56px !important;
                border-radius: 16px !important;
            }
            
            .main-btn-mobile i {
                font-size: 20px !important;
            }
            
            /* Header mobile ottimizzato */
            header {
                padding: 20px 16px !important;
            }
            
            .container.mx-auto {
                padding-left: 16px !important;
                padding-right: 16px !important;
            }
        }

        /* 🎯 MODAL PERFETTAMENTE CENTRATI E VISIBILI */
        .modal-backdrop {
            overflow-y: auto;
        }
        
        /* Tutti i modal - posizionamento ottimale */
        [id$="-modal"] {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 16px !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 9999 !important;
        }
        
        [id$="-modal"].hidden {
            display: none !important;
        }
        
        /* Container modal - sempre visibile e scrollabile */
        [id$="-modal"] > div {
            max-height: 85vh !important;
            overflow-y: auto !important;
        }
        
        /* 🎯 FIX DEFINITIVO POSIZIONAMENTO MODAL ENTRATA/USCITA */
        #add-modal:not(.hidden) {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 10000 !important;
            padding: 20px !important;
        }
        
        #add-modal.hidden {
            display: none !important;
        }
        
        #add-modal > div {
            margin: auto !important;
            max-height: 80vh !important;
            overflow-y: auto !important;
            background: white !important;
            border-radius: 12px !important;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25) !important;
            margin: 0 !important;
            position: relative !important;
            transform: none !important;
        }
        
        /* 📱 OTTIMIZZAZIONI SPECIFICHE MOBILE */
        @media (max-width: 480px) {
            #add-modal {
                padding: 10px !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            #add-modal > div {
                max-height: 90vh !important;
                width: calc(100% - 20px) !important;
                max-width: none !important;
                border-radius: 12px !important;
                margin: auto !important;
                position: relative !important;
                top: auto !important;
                left: auto !important;
                transform: none !important;
            }
            
            /* Pulsanti più grandi per touch */
            #add-modal button {
                min-height: 48px !important;
                font-size: 16px !important;
                padding: 12px 24px !important;
                border-radius: 10px !important;
            }
            
            /* Input più grandi e accessibili */
            #add-modal input, #add-modal select {
                min-height: 48px !important;
                font-size: 16px !important;
                padding: 12px 16px !important;
                border-radius: 8px !important;
            }
            
            /* Migliore spaziatura per touch */
            #add-modal .space-y-5 > * + * {
                margin-top: 24px !important;
            }
            
            /* 👆 PULSANTI PRINCIPALI ENTRY/EXIT OTTIMIZZATI PER TOUCH */
            .main-btn-mobile {
                min-height: 56px !important;
                font-size: 18px !important;
                padding: 16px 24px !important;
                border-radius: 12px !important;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                transition: all 0.2s ease !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 12px !important;
                width: 100% !important;
                margin: 8px 0 !important;
            }
            
            .main-btn-mobile:active {
                transform: scale(0.97) !important;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
            }
            
            /* Icone più grandi per migliore visibilità */
            .main-btn-mobile i {
                font-size: 20px !important;
            }
        }
        
        /* 📱 CENTRAGGIO FORZATO PER TUTTI I MOBILE */
        @media (max-width: 768px) {
            #add-modal {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 20px !important;
                z-index: 10000 !important;
                box-sizing: border-box !important;
            }
            
            #add-modal > div {
                margin: auto !important;
                position: static !important;
                transform: none !important;
                display: block !important;
                max-height: 85vh !important;
                width: 100% !important;
                max-width: 100% !important;
                overflow-y: auto !important;
                box-sizing: border-box !important;
            }
            
            /* 🔧 SCROLL SICURO PER CONTENUTO LUNGO */
            #add-modal .space-y-5 {
                max-height: calc(85vh - 120px) !important;
                overflow-y: auto !important;
                padding-right: 10px !important;
            }
            
            /* 🎯 PULSANTI SEMPRE VISIBILI IN FONDO */
            #add-modal .flex.justify-end {
                position: sticky !important;
                bottom: 0 !important;
                background: white !important;
                padding-top: 15px !important;
                margin-top: 15px !important;
                border-top: 1px solid #e5e7eb !important;
            }
        }
        
        /* 📱 TABLET OTTIMIZZAZIONI (481px - 768px) */
        @media (min-width: 481px) and (max-width: 768px) {
            #add-modal > div {
                max-width: 500px !important;
                max-height: 75vh !important;
            }
            
            .main-btn-mobile {
                min-height: 52px !important;
                font-size: 17px !important;
            }
        }
        
        /* 📱 OTTIMIZZAZIONI GENERALI MOBILE PER TUTTI GLI ELEMENTI */
        @media (max-width: 768px) {
            /* Tutti i pulsanti più touch-friendly */
            button:not(.main-btn-mobile) {
                min-height: 44px !important;
                padding: 12px 16px !important;
                font-size: 16px !important;
                border-radius: 8px !important;
                margin: 4px 0 !important;
            }
            
            /* Input e select ottimizzati per mobile */
            input, select, textarea {
                min-height: 48px !important;
                font-size: 16px !important;
                padding: 12px 16px !important;
                border-radius: 8px !important;
                border: 2px solid #e5e7eb !important;
                transition: all 0.2s ease !important;
            }
            
            /* Focus states più evidenti su mobile */
            input:focus, select:focus, textarea:focus {
                border-color: #3b82f6 !important;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
                transform: scale(1.02) !important;
            }
            
            /* Cards e contenitori più spaziosi */
            .card, .bg-white, [class*="card"] {
                padding: 20px !important;
                margin: 12px 0 !important;
                border-radius: 12px !important;
            }
            
            /* Testo più leggibile su mobile */
            h1 { font-size: 24px !important; }
            h2 { font-size: 20px !important; }
            h3 { font-size: 18px !important; }
            
            /* Link e elementi cliccabili più grandi */
            a, [onclick], .cursor-pointer {
                min-height: 44px !important;
                display: flex !important;
                align-items: center !important;
                padding: 8px 12px !important;
            }
            
            /* Migliore spaziatura per liste */
            li {
                padding: 12px 0 !important;
                border-bottom: 1px solid #f3f4f6 !important;
            }
            
            /* Scroll più fluido su mobile */
            * {
                -webkit-overflow-scrolling: touch !important;
                scroll-behavior: smooth !important;
            }
        }
        
        /* 📱 SCHERMI MOLTO PICCOLI (iPhone SE, iPhone 5, etc.) */
        @media (max-width: 375px) and (max-height: 667px) {
            /* Modal ancora più ottimizzato per schermi piccoli */
            #add-modal {
                padding: 8px !important;
            }
            
            #add-modal > div {
                max-height: 90vh !important;
                border-radius: 12px !important;
                padding: 16px !important;
            }
            
            /* Pulsanti principali ancora più grandi */
            .main-btn-mobile {
                min-height: 60px !important;
                font-size: 18px !important;
                font-weight: 700 !important;
                margin: 12px 0 !important;
            }
            
            /* Riduzione spaziature per sfruttare meglio lo spazio */
            .space-y-5 > * + * {
                margin-top: 16px !important;
            }
            
            /* Header più compatto */
            header, .header {
                padding: 12px 16px !important;
            }
            
            /* Cards più compatte */
            .card, .bg-white {
                padding: 16px !important;
                margin: 8px 0 !important;
            }
        }
        
        /* 🌟 MIGLIORAMENTI ACCESSIBILITÀ MOBILE */
        @media (max-width: 768px) {
            /* Hover states disabilitati su touch (previene stati "stuck") */
            button:hover, a:hover, [onclick]:hover {
                transform: none !important;
            }
            
            /* Active states più evidenti per feedback tattile */
            button:active, a:active, [onclick]:active {
                transform: scale(0.95) !important;
                transition: transform 0.1s ease !important;
            }
            
            /* Migliore contrasto per leggibilità */
            .text-gray-600 { color: #374151 !important; }
            .text-gray-500 { color: #4b5563 !important; }
            .text-gray-400 { color: #6b7280 !important; }
        }
        
        @media (max-width: 768px) {
            .modal-backdrop {
                background: rgba(15, 23, 42, 0.95);
                backdrop-filter: blur(12px);
                padding: 16px;
            }
            
            /* 📱 MOBILE MODAL - CENTRAGGIO PERFETTO CON SFONDO SCURO */
            [id$="-modal"] {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 12px !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                z-index: 9999 !important;
            }
            
            [id$="-modal"] > div {
                max-height: 88vh !important;
                width: calc(100vw - 24px) !important;
                max-width: 400px !important;
                margin: 0 !important;
                position: relative !important;
                display: block !important;
                overflow-y: auto !important;
                border-radius: 16px !important;
                
                /* 🎨 SFONDO SCURO PER LEGGIBILITÀ MOBILE */
                background: #1a202c !important;
                border: 2px solid #4a5568 !important;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8) !important;
                
                /* Forza centraggio assoluto */
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
            }
            
            /* 🎨 TESTO BIANCO E LEGGIBILE SU MOBILE MODAL */
            [id$="-modal"] h1,
            [id$="-modal"] h2, 
            [id$="-modal"] h3,
            [id$="-modal"] h4,
            [id$="-modal"] h5,
            [id$="-modal"] h6 {
                color: #ffffff !important;
                text-shadow: none !important;
            }
            
            [id$="-modal"] p,
            [id$="-modal"] span,
            [id$="-modal"] label,
            [id$="-modal"] div {
                color: #e2e8f0 !important;
                text-shadow: none !important;
            }
            
            /* 🎨 INPUT NEI MODAL - CONTRASTO MASSIMO */
            [id$="-modal"] input,
            [id$="-modal"] select,
            [id$="-modal"] textarea {
                background: #374151 !important;
                border: 2px solid #6b7280 !important;
                color: #ffffff !important;
                font-weight: 600 !important;
                font-size: 16px !important;
                box-shadow: 
                    inset 0 2px 4px rgba(0, 0, 0, 0.2),
                    0 4px 8px rgba(0, 0, 0, 0.3) !important;
            }
            
            [id$="-modal"] input:focus,
            [id$="-modal"] select:focus,
            [id$="-modal"] textarea:focus {
                background: #4b5563 !important;
                border-color: #3b82f6 !important;
                color: #ffffff !important;
                box-shadow: 
                    0 0 0 3px rgba(59, 130, 246, 0.4) !important,
                    inset 0 2px 4px rgba(0, 0, 0, 0.2),
                    0 6px 12px rgba(0, 0, 0, 0.4) !important;
            }
            
            [id$="-modal"] input::placeholder,
            [id$="-modal"] select::placeholder,
            [id$="-modal"] textarea::placeholder {
                color: #d1d5db !important;
                font-weight: 400 !important;
            }
            
            /* 🎨 BOTTONI NEI MODAL - CONTRASTO PERFETTO */
            [id$="-modal"] button {
                font-weight: 700 !important;
                border: 2px solid transparent !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
                font-size: 15px !important;
            }
            
            [id$="-modal"] button[type="submit"],
            [id$="-modal"] .btn-primary {
                background: #3b82f6 !important;
                color: #ffffff !important;
                border-color: #2563eb !important;
            }
            
            [id$="-modal"] button[type="button"] {
                background: #6b7280 !important;
                color: #ffffff !important;
                border-color: #4b5563 !important;
            }
            
            [id$="-modal"] button:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5) !important;
            }
            
            .form-section {
                background: rgba(0, 0, 0, 0.1) !important;
                backdrop-filter: blur(55px) saturate(250%) brightness(1.2) !important;
                border-radius: 28px !important;
                box-shadow: 
                    0 20px 80px rgba(0, 0, 0, 0.08),
                    0 8px 40px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
                width: 100% !important;
                max-width: 400px !important;
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        /* Modal desktop centrati */
        @media (min-width: 769px) {
            .form-section {
                max-height: 80vh;
                overflow-y: auto;
            }
        }

        /* Animazione smooth per apertura modal */
        #add-modal .form-section {
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        #add-modal:not(.hidden) .form-section {
            transform: translateY(0);
            opacity: 1;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.12);
            backdrop-filter: blur(45px) saturate(220%) brightness(1.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 
                0 10px 50px rgba(0, 0, 0, 0.08),
                0 4px 25px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }

        .stat-card:hover {
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transform: translateY(-4px) scale(1.01);
            box-shadow: 
                0 16px 60px rgba(0, 0, 0, 0.08),
                0 6px 30px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }

        /* Chart wrapper ultra-trasparente professionale */
        .chart-wrapper {
            position: relative;
            background: rgba(0, 0, 0, 0.04);
            backdrop-filter: blur(45px) saturate(220%) brightness(1.08);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 40px rgba(0, 0, 0, 0.03),
                inset 0 1px 0 rgba(255, 255, 255, 0.06);
            padding: 24px;
            backdrop-filter: blur(20px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }
        
        /* 📱 GRAFICI RESPONSIVE MOBILE-FIRST */
        .chart-responsive {
            position: relative;
            width: 100% !important;
            height: 0 !important;
            padding-bottom: 100% !important; /* Aspect ratio 1:1 */
            margin: 0 auto;
        }
        
        .chart-responsive canvas {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        /* 📱 MOBILE: Grafici più grandi e touch-friendly */
        @media (max-width: 768px) {
            .chart-wrapper {
                padding: 16px !important;
                margin: 8px !important;
                border-radius: 16px !important;
            }
            
            .chart-responsive {
                max-width: 350px; /* Limite massimo su mobile */
                padding-bottom: 100% !important; /* Mantiene proporzioni quadrate */
            }
            
            .chart-container.mobile-optimized {
                margin: 20px 0 !important;
                padding: 10px 0 !important;
            }
        }
        
        /* 💻 DESKTOP: Dimensioni ottimali */
        @media (min-width: 769px) {
            .chart-responsive {
                max-width: 400px;
                padding-bottom: 400px !important; /* Dimensione fissa desktop */
            }
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 600;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.02em;
        }

        .loading-circle {
            width: 180px;
            height: 180px;
            border: 6px solid #f1f5f9;
            border-top: 6px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 24px;
        }

        .loading-circle-amber {
            width: 180px;
            height: 180px;
            border: 6px solid #fef3c7;
            border-top: 6px solid #f59e0b;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 24px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* LAVA TITLE - EFFETTO BOLLE ROSA ANIMATE */
        .lava-title {
            position: relative;
            overflow: hidden;
        }
        
        .lava-title::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(244, 114, 182, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(236, 72, 153, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 60% 20%, rgba(190, 24, 93, 0.25) 0%, transparent 50%);
            border-radius: 12px;
            animation: lava-bubble-dance 6s ease-in-out infinite;
            z-index: -1;
        }
        
        .lava-title::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 40% 80%, rgba(255, 192, 203, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 90% 10%, rgba(255, 105, 180, 0.15) 0%, transparent 40%);
            border-radius: 12px;
            animation: lava-bubble-dance 8s ease-in-out infinite reverse;
            z-index: -1;
        }
        
        @keyframes lava-bubble-dance {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 0.6;
            }
            25% {
                transform: scale(1.05) rotate(90deg);
                opacity: 0.8;
            }
            50% {
                transform: scale(0.95) rotate(180deg);
                opacity: 0.7;
            }
            75% {
                transform: scale(1.02) rotate(270deg);
                opacity: 0.9;
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 0.6;
            }
        }
        
        /* Effetto hover potenziato per lava-title */
        .lava-title:hover::before,
        .lava-title:hover::after {
            animation-duration: 3s;
        }
        
        .lava-title:hover {
            transform: scale(1.02);
            transition: transform 0.3s ease;
        }

        /* 🎯 DRAG & DROP STYLES */
        .sortable-ghost {
            opacity: 0.4;
            transform: scale(0.98);
        }

        .sortable-chosen {
            cursor: grabbing !important;
            transform: rotate(2deg) scale(1.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            z-index: 1000;
        }

        .sortable-drag {
            transform: rotate(5deg);
            opacity: 0.8;
        }

        .drag-handle {
            cursor: grab;
            color: rgba(255, 255, 255, 0.75);
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
            font-weight: 600;
        }

        .drag-handle:hover {
            color: rgba(6, 182, 212, 1);
            text-shadow: 0 2px 8px rgba(6, 182, 212, 0.4);
            transform: scale(1.1);
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        /* Investment cards con drag handle */
        .investment-card-draggable {
            position: relative;
            transition: all 0.3s ease;
        }

        .investment-card-draggable:hover .drag-handle {
            opacity: 1;
        }

        /* 🔍 SEARCH & FILTERS ENHANCEMENTS */
        .search-result-highlight {
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.1) 0%, transparent 100%);
            border-left: 3px solid #06b6d4;
            padding-left: 8px;
            margin: 2px 0;
            border-radius: 0 6px 6px 0;
        }

        .filter-active {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6) !important;
            color: white !important;
            box-shadow: 0 4px 14px 0 rgba(6, 182, 212, 0.4);
        }

        /* Animazioni per risultati ricerca */
        .search-results-enter {
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 📊 ENHANCED CHART STYLES */
        .chart-container-enhanced {
            position: relative;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .chart-container-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #06b6d4, #8b5cf6);
            border-radius: 16px 16px 0 0;
        }

        /* Statistiche rapide ultra-trasparenti professionali */
        .stat-card {
            background: rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(35px) saturate(200%) brightness(1.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 
                0 8px 40px rgba(0, 0, 0, 0.04),
                0 3px 15px rgba(0, 0, 0, 0.03),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        .stat-card:hover {
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transform: translateY(-4px) scale(1.01);
            box-shadow: 
                0 16px 60px rgba(0, 0, 0, 0.08),
                0 6px 30px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }

        /* 🎮 RESPONSIVE ENHANCEMENTS */
        @media (max-width: 768px) {
            .sortable-investments {
                grid-template-columns: 1fr !important;
            }
            
            .drag-handle {
                display: none; /* Nascondi drag su mobile, usa touch gestures */
            }
            
            .search-content {
                padding: 16px;
            }
            
            .chart-container-enhanced {
                padding: 12px;
            }
        }

        /* Security Overlay Professionale */
        #security-overlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9998 !important;  /* 🎯 FIX: Z-index più basso dei modal (9999) */
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            background: rgba(0, 0, 0, 0.85) !important;
            backdrop-filter: blur(20px) !important;
            overflow: hidden !important;
            /* 🎯 FIX CLICK: Permetti click attraverso l'overlay, tranne nel contenuto */
            pointer-events: none !important;
        }

        #security-overlay > div {
            background: rgba(0, 0, 0, 0.4) !important;
            backdrop-filter: blur(20px) !important;
            /* 🎯 FIX CLICK: Il contenuto deve rimanere cliccabile */
            pointer-events: auto !important;
            /* 🎯 FIX Z-INDEX: Setup password sopra i modal */
            z-index: 99999 !important;
            position: relative !important;
        }
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 16px !important;
        }

        .security-input:focus {
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
            border-color: #06b6d4;
        }

        .security-button {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            transition: all 0.3s ease;
        }

        .security-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.4);
        }

        /* Previene scroll quando overlay è attivo */
        body.security-locked {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
        }

        /* 🎯 FIX DEFINITIVO MODAL: Z-index massimo per tutti i modal */
        #add-modal,
        #quick-expense-modal,
        #investment-modal,
        #investment-update-modal,
        #project-component-modal,
        #project-return-modal {
            z-index: 10000 !important;
        }

        /* Modal sempre sopra il security overlay */
        .modal-container {
            z-index: 10000 !important;
            position: fixed !important;
        }

        /* PWA Install Banner */
        .pwa-banner {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Loading states */
        .loading-skeleton {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Notification enhancements */
        .notification-enhanced {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        /* Touch feedback */
        .touch-feedback {
            position: relative;
            overflow: hidden;
        }

        .touch-feedback::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(6, 182, 212, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            pointer-events: none;
        }

        .touch-feedback:active::before {
            width: 300px;
            height: 300px;
        }

        /* 🎵 Animazione click blob */
        @keyframes blob-click {
            0% { 
                transform: scale(1);
                filter: brightness(1) saturate(1);
            }
            50% { 
                transform: scale(1.15);
                filter: brightness(1.4) saturate(1.6) hue-rotate(30deg);
            }
            100% { 
                transform: scale(1);
                filter: brightness(1) saturate(1);
            }
        }

        /* Tipografia Ultra-Professionale */
        .card h1, .card h2, .card h3, .card h4, .card h5, .card h6 {
            color: rgba(255, 255, 255, 0.98) !important;
            font-weight: 700;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 0.75rem;
        }

        .card p, .card span, .card div, .card td, .card th {
            color: rgba(255, 255, 255, 0.85) !important;
            font-weight: 500;
            letter-spacing: -0.01em;
            line-height: 1.6;
        }

        .card .text-gray-900, .card .text-gray-800, .card .text-gray-700 {
            color: rgba(255, 255, 255, 0.95) !important;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            font-weight: 600;
        }

        .card .text-gray-600, .card .text-gray-500 {
            color: rgba(255, 255, 255, 0.8) !important;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
            font-weight: 500;
        }

        .card .text-gray-400 {
            color: rgba(255, 255, 255, 0.7) !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-weight: 500;
        }

        /* Override per tutti i testi nelle sezioni */
        h1, h2, h3, h4, h5, h6 {
            color: rgba(255, 255, 255, 0.98) !important;
            font-weight: 700;
            letter-spacing: -0.025em;
            text-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        }

        p, span, div, label {
            color: rgba(255, 255, 255, 0.87) !important;
            font-weight: 500;
            letter-spacing: -0.01em;
            line-height: 1.65;
        }

        /* Bottoni Professionali */
        button {
            background: rgba(0, 0, 0, 0.06) !important;
            backdrop-filter: blur(40px) saturate(200%) brightness(1.08);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            font-weight: 600;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        button:hover {
            background: rgba(0, 0, 0, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 40px rgba(0, 0, 0, 0.08),
                0 4px 20px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }

        button:active {
            transform: translateY(-1px) scale(1.01);
            transition: all 0.1s ease;
        }

        /* Effetto ondina sui click */
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s, opacity 0.6s;
            opacity: 0;
            pointer-events: none;
        }

        button:active::after {
            width: 300px;
            height: 300px;
            opacity: 1;
            transition: all 0s;
        }

        /* 🎨 LAYOUT MODERNO E PULITO */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .modern-section {
            margin: 32px 0;
            padding: 24px;
            border-radius: 24px;
        }

        .grid-modern {
            display: grid;
            gap: 24px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .flex-modern {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Bottoni colorati specifici */
        .bg-emerald-500, .bg-green-500 {
            background: rgba(34, 197, 94, 0.8) !important;
        }

        .bg-red-500 {
            background: rgba(239, 68, 68, 0.8) !important;
        }

        .bg-blue-500 {
            background: rgba(59, 130, 246, 0.8) !important;
        }

        /* Tabelle Professionali */
        table {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(12px);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            overflow: hidden;
        }

        thead {
            background: rgba(0, 0, 0, 0.3);
        }

        tbody tr {
            background: rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        tbody tr:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        td, th {
            color: rgba(255, 255, 255, 0.9) !important;
            border-color: rgba(255, 255, 255, 0.05) !important;
            padding: 12px 16px;
        }

        /* Input e Select Professionali */
        input, select, textarea {
            background: rgba(0, 0, 0, 0.12) !important;
            backdrop-filter: blur(40px) saturate(200%) brightness(1.15) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 16px !important;
            color: rgba(255, 255, 255, 1) !important;
            padding: 14px 18px !important;
            font-weight: 500 !important;
            box-shadow: 
                0 6px 30px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.12) !important;
        }

        input:focus, select:focus, textarea:focus {
            border-color: rgba(59, 130, 246, 0.7) !important;
            background: rgba(0, 0, 0, 0.1) !important;
            box-shadow: 
                0 0 0 3px rgba(59, 130, 246, 0.15) !important,
                0 4px 20px rgba(59, 130, 246, 0.1) !important;
            color: rgba(255, 255, 255, 1) !important;
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* 🖥️ DESKTOP MODAL FIX - CONTRASTO PERFETTO per schermi grandi */
        @media (min-width: 769px) {
            /* Modal su desktop: testo scuro su sfondo bianco */
            [id$="-modal"] h1,
            [id$="-modal"] h2, 
            [id$="-modal"] h3,
            [id$="-modal"] h4,
            [id$="-modal"] h5,
            [id$="-modal"] h6 {
                color: #111827 !important;  /* Nero per titoli */
            }
            
            [id$="-modal"] p,
            [id$="-modal"] span:not(.fas):not(.fa),
            [id$="-modal"] label {
                color: #374151 !important;  /* Grigio scuro per testo */
            }
            
            [id$="-modal"] div:not([class*="bg-"]) {
                color: inherit !important;  /* Permetti eredità per div senza background */
            }
            
            /* Input desktop: sfondo bianco + testo nero = LEGGIBILE */
            [id$="-modal"] input:not([type="checkbox"]):not([type="radio"]),
            [id$="-modal"] select,
            [id$="-modal"] textarea {
                background: #ffffff !important;
                border: 2px solid #d1d5db !important;
                color: #111827 !important;
                font-weight: 500 !important;
            }
            
            /* Placeholder leggibili su desktop */
            [id$="-modal"] input::placeholder {
                color: #6b7280 !important;
            }
        }
        
        /* 🔥 FIX CONTRASTO INTERFACCIA PRINCIPALE - SEZIONI LEGGIBILI */
        
        /* Sezioni principali del sito con contrasto ottimizzato */
        .transactions-section h3,
        .chart-wrapper h3, 
        .chart-wrapper h4,
        #investments-section h3,
        #investments-section h4 {
            color: #111827 !important;  /* Titoli neri per leggibilità */
            text-shadow: none !important;
        }
        
        /* Testo normale nelle sezioni principali */
        .transactions-section p,
        .transactions-section span:not(.fas):not(.fa),
        .transactions-section div:not([class*="bg-"]),
        .chart-wrapper p,
        .chart-wrapper span:not(.fas):not(.fa),
        .chart-wrapper div:not([class*="bg-"]),
        #investments-section p,
        #investments-section span:not(.fas):not(.fa),
        #investments-section div:not([class*="bg-"]) {
            color: #374151 !important;  /* Testo grigio scuro */
            text-shadow: none !important;
        }
        
        /* Fix specifico per liste transazioni */
        #transactions-list .transaction-item,
        #transactions-list .transaction-item *:not(.fas):not(.fa) {
            color: #111827 !important;
        }
        
        /* Fix per sezione investimenti */
        #investments-summary *:not(.fas):not(.fa),
        #frequent-analysis *:not(.fas):not(.fa),
        #monthly-frequent-summary *:not(.fas):not(.fa) {
            color: #374151 !important;
        }
        
        /* Override delle classi Tailwind problematiche */
        .card .text-gray-900,
        .card .text-gray-800, 
        .card .text-gray-700,
        .card .text-gray-600,
        .card .text-gray-500 {
            color: #374151 !important;  /* Forza grigio scuro leggibile */
        }
        
        /* Assicura che i titoli delle carte siano sempre leggibili */
        .card h1, .card h2, .card h3, .card h4, .card h5, .card h6 {
            color: #111827 !important;  /* Titoli neri */
        }
        
        /* 🔥 FIX ADDIZIONALI per elementi dinamici */
        
        /* Tabelle e liste generate dinamicamente */
        table, .table,
        .transaction-item,
        .investment-item,
        .frequent-item {
            color: #374151 !important;
        }
        
        /* Bottoni e link nell'interfaccia (esclusi bottoni principali) */
        button:not([class*="bg-"]):not(.btn-success):not(.btn-error):not(.main-btn-mobile) {
            color: #374151 !important;
        }
        
        /* Select e input nell'interfaccia principale (non nei modal) */
        select:not([id$="-modal"] select),
        input:not([id$="-modal"] input) {
            color: #111827 !important;
            background-color: #ffffff !important;
        }
        
        /* Fix per statistiche e numeri */
        .stat-value, .balance-amount,
        .currency, .amount {
            color: #111827 !important;
            font-weight: 600;
        }
        
        /* Assicura leggibilità su tutti gli sfondi chiari */
        .bg-white *, .bg-gray-50 *, .bg-blue-50 *, 
        .bg-indigo-50 *, .bg-green-50 * {
            color: #374151 !important;
        }
        
        .bg-white h1, .bg-white h2, .bg-white h3,
        .bg-gray-50 h1, .bg-gray-50 h2, .bg-gray-50 h3,
        .bg-blue-50 h1, .bg-blue-50 h2, .bg-blue-50 h3 {
            color: #111827 !important;
        }
    </style>
</head>
<body>
    <!-- Background Professionale -->
    <div class="lava-lamp-container">
        <div class="lava-blob blob-1"></div>
        <div class="lava-blob blob-2"></div>
        <div class="lava-blob blob-3"></div>
        <div class="lava-blob blob-4"></div>
        <div class="lava-blob blob-5"></div>
        <div class="lava-blob blob-6"></div>
        <div class="lava-blob blob-7"></div>
        <div class="lava-blob blob-8"></div>
        
        <!-- Particelle flottanti -->
        <div class="particle-system">
            <div class="particle particle-1"></div>
            <div class="particle particle-2"></div>
            <div class="particle particle-3"></div>
            <div class="particle particle-4"></div>
            <div class="particle particle-5"></div>
            <div class="particle particle-6"></div>
        </div>
    </div>

    <!-- Content Overlay -->
    <div class="content-overlay">
    <!-- Header Professionale -->
    <header class="shadow-2xl" style="background: rgba(0, 0, 0, 0.05); backdrop-filter: blur(60px) saturate(250%) brightness(1.15); border-bottom: 1px solid rgba(255, 255, 255, 0.12); border-radius: 0 0 20px 20px; box-shadow: 0 8px 40px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.1);">
        <div class="container mx-auto px-6 py-6">
            <!-- Header Layout Responsive -->
            <div class="flex flex-col space-y-4">
                <!-- Titolo e Saldo -->
                <div class="flex items-center justify-between">
                    <div class="title-section flex-1">
                        <div class="flex items-center justify-between mb-6">
                    <h1 class="animated-logo">SAPO TRACKER</h1>
                    <div class="flex-1"></div>
                </div>
                    </div>
                    
                    <div class="text-right">
                        <p class="text-white/80 text-sm">Saldo Totale</p>
                        <p id="header-balance" class="text-2xl font-semibold text-white">€0.00</p>
                        <p id="header-breakdown" class="text-white/60 text-xs mt-1" style="display: none;">
                            <span class="mr-2">💰 <span id="header-cash">€0</span></span>
                            <span>📉 -<span id="header-investments">€0</span></span>
                        </p>
                    </div>
                </div>
                
                <!-- Tasti Azioni Principali -->
                <div class="flex justify-center gap-3 main-actions-mobile">
                    <!-- 🚀 NUOVI PULSANTI FUNZIONANTI GARANTITI -->
                    <!-- Tasto Entrate (Verde) - FUNZIONAMENTO GARANTITO -->
                    <button onclick="openModalDirect('entrata');" class="btn-success text-white px-6 py-4 rounded-lg font-semibold transition-colors shadow-lg flex items-center gap-3 main-btn-mobile">
                        <i class="fas fa-arrow-up text-xl"></i>
                        <span>💰 Entrata</span>
                    </button>
                    
                    <!-- Tasto Uscite (Rosso) - FUNZIONAMENTO GARANTITO -->
                    <button onclick="openModalDirect('uscita');" class="btn-error text-white px-6 py-4 rounded-lg font-semibold transition-colors shadow-lg flex items-center gap-3 main-btn-mobile">
                        <i class="fas fa-arrow-down text-xl"></i>
                        <span>💸 Uscita</span>
                    </button>
                    
                    <!-- Tasto Investimenti (Blu) -->
                    <button onclick="scrollToInvestments()" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors shadow-lg flex items-center gap-2">
                        <i class="fas fa-chart-line"></i>
                        <span class="hidden sm:inline">Invest.</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Ricerca e Filtri -->
    <section style="background: rgba(0, 0, 0, 0.04); backdrop-filter: blur(45px) saturate(220%) brightness(1.1); border-top: 1px solid rgba(255, 255, 255, 0.08); border-bottom: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; margin: 16px; box-shadow: 0 6px 30px rgba(0, 0, 0, 0.03), inset 0 1px 0 rgba(255, 255, 255, 0.06);">
        <div class="container mx-auto px-6 py-4">
            <!-- Toggle Ricerca/Filtri -->
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                    <i class="fas fa-search text-cyan-400"></i>
                    Ricerca e Filtri
                </h3>
                <button id="toggle-search" class="text-slate-400 hover:text-white transition-colors">
                    <i class="fas fa-chevron-down" id="search-chevron"></i>
                </button>
            </div>

            <!-- Contenuto Ricerca (inizialmente nascosto) -->
            <div id="search-content" class="hidden space-y-4">
                <!-- Barra Ricerca Globale -->
                <div class="flex flex-col sm:flex-row gap-3">
                    <div class="flex-1 relative">
                        <input type="text" id="global-search" 
                               placeholder="🔍 Cerca transazioni, investimenti, categorie..."
                               class="w-full px-4 py-3 pl-10 bg-slate-700/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
                        <i class="fas fa-search absolute left-3 top-4 text-slate-400"></i>
                    </div>
                    <button id="clear-search" class="px-4 py-3 bg-slate-600/50 text-slate-300 rounded-xl hover:bg-slate-600 transition-colors border border-slate-600/50">
                        <i class="fas fa-times"></i> Cancella
                    </button>
                </div>

                <!-- Filtri Avanzati -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                    <!-- Filtro Tipo -->
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-1">Tipo</label>
                        <select id="filter-type" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="">Tutti</option>
                            <option value="income">💚 Entrate</option>
                            <option value="expense">❤️ Uscite</option>
                            <option value="investment">💎 Investimenti</option>
                        </select>
                    </div>

                    <!-- Filtro Categoria -->
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-1">Categoria</label>
                        <select id="filter-category" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="">Tutte le categorie</option>
                            <!-- Categorie popolate dinamicamente -->
                        </select>
                    </div>

                    <!-- Filtro Periodo -->
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-1">Periodo</label>
                        <select id="filter-period" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="">Tutto</option>
                            <option value="today">Oggi</option>
                            <option value="week">Questa settimana</option>
                            <option value="month">Questo mese</option>
                            <option value="quarter">Ultimi 3 mesi</option>
                            <option value="year">Quest'anno</option>
                            <option value="custom">Periodo personalizzato</option>
                        </select>
                    </div>

                    <!-- Filtro Importo -->
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-1">Importo</label>
                        <select id="filter-amount" class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="">Tutti gli importi</option>
                            <option value="0-50">€0 - €50</option>
                            <option value="50-200">€50 - €200</option>
                            <option value="200-500">€200 - €500</option>
                            <option value="500-1000">€500 - €1.000</option>
                            <option value="1000+">€1.000+</option>
                        </select>
                    </div>
                </div>

                <!-- Filtro Date Personalizzate (nascosto inizialmente) -->
                <div id="custom-date-range" class="hidden grid grid-cols-1 sm:grid-cols-2 gap-3 pt-2 border-t border-slate-600/50">
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-1">Da</label>
                        <input type="date" id="date-from" 
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                    </div>
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-1">A</label>
                        <input type="date" id="date-to"
                               class="w-full px-3 py-2 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                    </div>
                </div>

                <!-- Risultati Ricerca -->
                <div class="flex items-center justify-between pt-2 border-t border-slate-600/50">
                    <div class="flex items-center space-x-4">
                        <span id="search-results-count" class="text-slate-400 text-sm">Nessun filtro attivo</span>
                        <button id="export-filtered" class="hidden text-cyan-400 hover:text-cyan-300 text-sm transition-colors">
                            <i class="fas fa-download"></i> Esporta risultati
                        </button>
                    </div>
                    <button id="reset-filters" class="text-slate-400 hover:text-white text-sm transition-colors">
                        <i class="fas fa-undo"></i> Reset filtri
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Chart Section - Prima Sezione -->
        <div class="mb-8">
            <div class="chart-wrapper card">
                <!-- Tasti Rapidi Spese Frequenti -->
                <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-zap text-yellow-500 mr-2"></i>
                        Spese Rapide
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3" id="quick-expense-buttons">
                        <!-- I bottoni saranno generati dinamicamente -->
                    </div>
                </div>

                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-chart-pie text-blue-600 mr-2"></i>
                        Distribuzione Spese
                    </h3>
                    <button onclick="exportData()" class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                
                <div class="chart-container mobile-optimized">
                    <div class="chart-responsive">
                        <canvas id="expenseChart"></canvas>
                    </div>
                </div>
                
                <div id="chart-legend" class="mt-6 space-y-3"></div>
            </div>
        </div>

        <!-- Grafici Investimenti - Due Tipi -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Grafico Investimenti Finanziari -->
            <div class="chart-card professional-card rounded-xl p-6">
                <div class="text-center">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center">
                            <div class="bg-teal-100 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-chart-line text-teal-600"></i>
                            </div>
                            <div class="text-left">
                                <h3 class="text-lg font-semibold text-gray-900">Investimenti Liquidi</h3>
                                <p class="text-sm text-gray-600">Cripto, azioni, fondi (-saldo)</p>
                            </div>
                        </div>
                        <button onclick="openInvestmentModal('financial')" class="btn-success text-white px-4 py-3 rounded-lg font-medium transition-colors flex items-center gap-2 mobile-btn">
                            <i class="fas fa-coins text-lg"></i>
                            <span>Investi Liquidi</span>
                        </button>
                    </div>
                    
                    <div class="chart-container mobile-optimized">
                        <div class="chart-responsive">
                            <canvas id="investmentChart"></canvas>
                        </div>
                    </div>
                    
                    <div id="investment-chart-legend" class="mt-4 space-y-2"></div>
                </div>
            </div>

            <!-- Grafico Investimenti Materiali -->
            <div class="chart-card professional-card rounded-xl p-6">
                <div class="text-center">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center">
                            <div class="bg-amber-100 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-industry text-amber-600"></i>
                            </div>
                            <div class="text-left">
                                <h3 class="text-lg font-semibold text-gray-900">Investimenti Materiali</h3>
                                <p class="text-sm text-gray-600">Immobili, produzioni, beni (-saldo)</p>
                            </div>
                        </div>
                        <button onclick="openInvestmentModal('material')" class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white px-4 py-3 rounded-lg font-medium transition-colors flex items-center gap-2 mobile-btn shadow-lg">
                            <i class="fas fa-industry text-lg"></i>
                            <span>Progetto Materiale</span>
                        </button>
                    </div>
                    
                    <div class="chart-container mobile-optimized">
                        <div class="chart-responsive">
                            <canvas id="materialInvestmentChart"></canvas>
                        </div>
                    </div>
                    
                    <div id="material-investment-chart-legend" class="mt-4 space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8 stats-mobile-grid">
            <div class="stat-card professional-card rounded-lg p-6 text-center">
                <div class="bg-emerald-50 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-arrow-up text-emerald-600 text-lg"></i>
                </div>
                <p class="text-gray-600 text-sm mb-1">Entrate Mese</p>
                <p id="monthly-income" class="text-2xl font-bold text-gray-900">€0.00</p>
            </div>
            
            <div class="stat-card professional-card rounded-lg p-6 text-center">
                <div class="bg-red-50 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-arrow-down text-red-600 text-lg"></i>
                </div>
                <p class="text-gray-600 text-sm mb-1">Uscite Mese</p>
                <p id="monthly-expenses" class="text-2xl font-bold text-gray-900">€0.00</p>
            </div>
            
            <div class="stat-card professional-card rounded-lg p-6 text-center">
                <div class="bg-blue-50 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-list text-blue-600 text-lg"></i>
                </div>
                <p class="text-gray-600 text-sm mb-1">Transazioni</p>
                <p id="total-transactions" class="text-2xl font-bold text-gray-900">0</p>
            </div>
            
            <div class="stat-card professional-card rounded-lg p-6 text-center">
                <div class="bg-purple-50 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-balance-scale text-purple-600 text-lg"></i>
                </div>
                <p class="text-gray-600 text-sm mb-1">Bilancio Mese</p>
                <p id="balance" class="text-2xl font-bold text-gray-900">€0.00</p>
            </div>
            
            <div class="stat-card professional-card rounded-lg p-6 text-center">
                <div class="bg-orange-50 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-arrow-down text-orange-600 text-lg"></i>
                </div>
                <p class="text-gray-600 text-sm mb-1">Investimenti Liquidi</p>
                <p id="financial-investments-total" class="text-2xl font-bold text-gray-900">€0.00</p>
            </div>
            
            <div class="stat-card professional-card rounded-lg p-6 text-center">
                <div class="bg-red-50 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-arrow-down text-red-600 text-lg"></i>
                </div>
                <p class="text-gray-600 text-sm mb-1">Investimenti Materiali</p>
                <p id="material-investments-total" class="text-2xl font-bold text-gray-900">€0.00</p>
            </div>
        </div>

        <!-- Transactions List -->
        <div class="mb-8">
            <div class="chart-wrapper card transactions-section">
                <div class="flex items-center justify-between mb-6 mobile-header">
                    <h3 class="text-lg font-semibold text-gray-900 mobile-title">
                        <i class="fas fa-history text-blue-600 mr-2"></i>
                        Movimenti Recenti
                    </h3>
                    <select id="filterType" onchange="filterTransactions()" class="border border-gray-300 rounded-lg px-4 py-3 text-sm text-gray-700 bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mobile-select">
                        <option value="">Tutti</option>
                        <option value="entrata">Entrate</option>
                        <option value="uscita">Uscite</option>
                    </select>
                </div>
                
                <div id="transactions-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Portfolio Investimenti Interattivo -->
        <div id="investments-section" class="mb-8 chart-wrapper">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">
                    <i class="fas fa-wallet text-blue-600 mr-2"></i>
                    I Miei Investimenti
                </h3>
                <button onclick="openInvestmentModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                    <i class="fas fa-plus mr-2"></i>Nuovo
                </button>
            </div>
            
            <!-- Riepilogo Totale -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="investments-summary">
                    <!-- Summary cards generate dinamicamente -->
                </div>
            </div>
            
            <!-- Lista Investimenti Modificabili (Drag & Drop) -->
            <div id="investments-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sortable-investments">
                <!-- Investment cards generate dinamicamente con drag & drop -->
            </div>
            
            <!-- Indicatore Drag & Drop -->
            <div id="drag-helper" class="hidden fixed pointer-events-none bg-slate-800/90 text-white px-3 py-1 rounded-lg text-sm shadow-lg z-50">
                <i class="fas fa-arrows-alt mr-2"></i>
                Riorganizza investimenti
            </div>
        </div>

        <!-- Tabella Riassuntiva Tutti gli Investimenti -->
        <div class="chart-wrapper card rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <div class="bg-purple-100 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-table text-purple-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Riepilogo Investimenti</h3>
                        <p class="text-sm text-gray-600">Tutti gli investimenti divisi per tipologia</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-600">Totale Investito</div>
                    <div id="total-investments-amount" class="text-xl font-bold text-purple-600">€0.00</div>
                </div>
            </div>
            
            <div id="investments-summary-table" class="overflow-x-auto">
                <div class="text-center py-12 text-gray-500">
                    <i class="fas fa-chart-pie text-4xl text-gray-300 mb-4"></i>
                    <p class="mb-4">Nessun investimento presente</p>
                    <p class="text-sm">Crea i tuoi primi investimenti per vedere il riepilogo completo</p>
                </div>
            </div>
        </div>

        <!-- Analisi Movimenti Frequenti -->
        <div class="mt-8 chart-wrapper">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">
                <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
                Movimenti Frequenti del Mese
            </h3>
            <div id="frequent-analysis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"></div>
            
            <!-- Riepilogo mensile spese frequenti -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-calculator text-blue-600 mr-2"></i>
                    Conteggio Mensile Spese Ricorrenti
                </h4>
                <div id="monthly-frequent-summary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
                
                <!-- Confronto con mese precedente -->
                <div class="mt-6 pt-4 border-t border-blue-200">
                    <h5 class="text-md font-medium text-gray-800 mb-3">📈 Confronto con mese precedente</h5>
                    <div id="monthly-comparison" class="space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- 📈 GRAFICI TEMPORALI AVANZATI - Sezione Finale -->
        <section class="mb-8 mt-12">
            <div class="chart-wrapper card">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                        <i class="fas fa-chart-line text-cyan-600"></i>
                        Andamento Temporale Saldo
                    </h3>
                    <div class="flex gap-2">
                        <!-- Toggle periodo visualizzazione -->
                        <select id="chart-period" class="px-3 py-1 bg-gray-100 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="7">Ultimi 7 giorni</option>
                            <option value="30" selected>Ultimi 30 giorni</option>
                            <option value="90">Ultimi 3 mesi</option>
                            <option value="365">Ultimo anno</option>
                        </select>
                        <button id="refresh-chart" class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Canvas per grafici temporali -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Grafico Andamento Saldo -->
                    <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 chart-container-enhanced">
                        <h4 class="text-md font-medium text-gray-700 mb-3 flex items-center">
                            <i class="fas fa-wallet text-green-500 mr-2"></i>
                            Saldo nel Tempo
                        </h4>
                        <div style="position: relative; height: 280px;">
                            <canvas id="balanceTimeChart"></canvas>
                        </div>
                    </div>

                    <!-- Grafico Entrate vs Uscite -->
                    <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 chart-container-enhanced">
                        <h4 class="text-md font-medium text-gray-700 mb-3 flex items-center">
                            <i class="fas fa-exchange-alt text-purple-500 mr-2"></i>
                            Entrate vs Uscite
                        </h4>
                        <div style="position: relative; height: 280px;">
                            <canvas id="incomeExpenseChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Statistiche rapide -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t border-gray-200">
                    <div class="text-center stat-card">
                        <div class="text-2xl font-bold text-green-600" id="stat-avg-income">€0</div>
                        <div class="text-sm text-gray-600">Media Entrate</div>
                    </div>
                    <div class="text-center stat-card">
                        <div class="text-2xl font-bold text-red-600" id="stat-avg-expense">€0</div>
                        <div class="text-sm text-gray-600">Media Uscite</div>
                    </div>
                    <div class="text-center stat-card">
                        <div class="text-2xl font-bold text-blue-600" id="stat-trend">0%</div>
                        <div class="text-sm text-gray-600">Trend Periodo</div>
                    </div>
                    <div class="text-center stat-card">
                        <div class="text-2xl font-bold text-purple-600" id="stat-transactions">0</div>
                        <div class="text-sm text-gray-600">Transazioni</div>
                    </div>
                </div>

                <!-- Info utilizzo grafici -->
                <div class="mt-6 pt-4 border-t border-gray-200 bg-gradient-to-r from-cyan-50 to-purple-50 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <div class="text-cyan-600 text-xl">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div>
                            <h6 class="font-medium text-gray-800 mb-1">💡 Come utilizzare i grafici temporali</h6>
                            <div class="text-sm text-gray-600 space-y-1">
                                <p>• <strong>Cambia periodo:</strong> Usa il menu a discesa per visualizzare 7 giorni, 30 giorni, 3 mesi o 1 anno</p>
                                <p>• <strong>Hover sui punti:</strong> Passa il mouse sui grafici per vedere dettagli specifici di ogni giorno</p>
                                <p>• <strong>Statistiche live:</strong> I dati si aggiornano automaticamente quando aggiungi nuove transazioni</p>
                                <p>• <strong>Trend percentuale:</strong> Mostra l'andamento del saldo nel periodo selezionato</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add Transaction Modal -->
    <div id="add-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4" style="z-index: 10000 !important;">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl border border-gray-200 mx-auto my-auto" style="max-height: 80vh; overflow-y: auto; margin: auto !important;">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold text-gray-900">
                    <i class="fas fa-plus-circle text-blue-600 mr-2"></i>
                    Nuova Transazione
                </h3>
                <button onclick="closeAddModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="transaction-form" class="space-y-5">
                <div>
                    <label class="block text-gray-700 font-medium mb-3">Tipo di movimento</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center text-gray-700 cursor-pointer">
                            <input type="radio" name="tipo" value="entrata" class="mr-2 text-emerald-500 focus:ring-emerald-500">
                            <i class="fas fa-arrow-up text-emerald-600 mr-2"></i>
                            Entrata
                        </label>
                        <label class="flex items-center text-gray-700 cursor-pointer">
                            <input type="radio" name="tipo" value="uscita" checked class="mr-2 text-red-500 focus:ring-red-500">
                            <i class="fas fa-arrow-down text-red-600 mr-2"></i>
                            Uscita
                        </label>
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Importo (€)</label>
                    <input type="number" step="0.01" name="importo" required 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Categoria</label>
                    <select name="categoria" required class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none bg-white">
                        <option value="">Seleziona categoria</option>
                        <option value="Ristorazione">🍽️ Ristorazione</option>
                        <option value="Tabaccherie">🚬 Tabaccherie</option>
                        <option value="Trasporti">🚗 Trasporti</option>
                        <option value="Spesa">🛒 Spesa Alimentare</option>
                        <option value="Abbigliamento">👕 Abbigliamento</option>
                        <option value="Salute">❤️ Salute</option>
                        <option value="Bollette">📄 Bollette</option>
                        <option value="Stipendio">💼 Stipendio</option>
                        <option value="Freelance">💻 Freelance</option>
                        <option value="Altro">📦 Altro</option>
                    </select>
                </div>

                <!-- Campo specifico per categoria Altro -->
                <div id="altro-type-field" class="hidden">
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-tag text-orange-600 mr-2"></i>Specifica tipo di spesa *
                    </label>
                    <input type="text" name="altro_tipo" 
                           class="w-full border border-orange-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none"
                           placeholder="es. Farmacia, Regali, Hobbies, Carburante...">
                    <p class="text-xs text-gray-500 mt-1">Questo verrà usato come categoria personalizzata</p>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Descrizione (opzionale)</label>
                    <input type="text" name="descrizione" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                           placeholder="Note aggiuntive...">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Data</label>
                    <input type="date" name="data" required
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" name="ricorrente" class="mr-3 text-blue-600 focus:ring-blue-500">
                    <label class="text-gray-700">Movimento ricorrente</label>
                </div>
                
                <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                    <button type="button" onclick="closeAddModal()" 
                            class="px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                        Annulla
                    </button>
                    <button type="submit" 
                            class="px-6 py-2.5 btn-primary text-white rounded-lg font-medium">
                        <i class="fas fa-save mr-2"></i>Salva Transazione
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Expense Modal -->
    <div id="quick-expense-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 overflow-y-auto min-h-screen" style="z-index: 10000 !important;">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl border border-gray-200 mx-auto max-h-[85vh] overflow-y-auto">
            <div class="text-center mb-6">
                <div id="quick-modal-emoji" class="text-4xl mb-3">🚬</div>
                <h3 class="text-xl font-semibold text-gray-900" id="quick-modal-title">Tabaccherie</h3>
                <p class="text-gray-600 text-sm">Conferma o modifica l'importo</p>
            </div>
            
            <div class="mb-6">
                <label class="block text-gray-700 font-medium mb-2">Importo (€)</label>
                <input type="number" step="0.01" id="quick-amount-input" 
                       class="w-full border border-gray-300 rounded-lg px-4 py-3 text-center text-lg font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                       onkeypress="if(event.key==='Enter') confirmQuickExpense()">
            </div>
            
            <div class="flex space-x-3">
                <button onclick="closeQuickExpenseModal()" 
                        class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                    Annulla
                </button>
                <button onclick="confirmQuickExpense()" 
                        class="flex-1 px-4 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors">
                    <i class="fas fa-check mr-2"></i>Conferma
                </button>
            </div>
        </div>
    </div>

    <!-- Investment Modal Semplificato -->
    <div id="investment-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 overflow-y-auto min-h-screen" style="z-index: 10000 !important;">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl border border-gray-200 mx-auto max-h-[85vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold text-gray-900">
                    <i class="fas fa-chart-line text-blue-600"></i>
                </h3>
                <button onclick="closeInvestmentModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="investment-form" class="space-y-5">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Tipo Investimento</label>
                    <select name="investment_type" required
                            class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                        <option value="">Seleziona tipo...</option>
                        <option value="financial">💰 Investimenti Liquidi (-saldo)</option>
                        <option value="material">🏭 Investimenti Materiali (-saldo)</option>
                    </select>
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">Emoji Investimento</label>
                    <input type="text" name="investment_emoji" maxlength="2" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 text-center text-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                           placeholder="📈" value="📈">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Nome Investimento</label>
                    <input type="text" name="investment_name" required
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                           placeholder="Es: Bitcoin, Apple, Casa">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Valore Attuale (€)</label>
                    <input type="number" step="0.01" name="investment_value" required
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Data</label>
                    <input type="date" name="investment_date" required
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                </div>
                
                <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                    <button type="button" onclick="closeInvestmentModal()" 
                            class="px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                        Annulla
                    </button>
                    <button type="submit" 
                            class="px-6 py-2.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors">
                        <i class="fas fa-save mr-2"></i>Crea
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Investment Update Modal -->
    <div id="investment-update-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 overflow-y-auto min-h-screen" style="z-index: 10000 !important;">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl border border-gray-200 mx-auto max-h-[85vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold text-gray-900">
                    <span id="update-modal-emoji" class="mr-2">📈</span>
                    <span id="update-modal-title">Aggiorna Investimento</span>
                </h3>
                <button onclick="closeInvestmentUpdateModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="text-center mb-6">
                <p class="text-gray-600 text-sm mb-2">Valore attuale</p>
                <p id="current-value" class="text-2xl font-bold text-blue-600">€0.00</p>
            </div>
            
            <form id="investment-update-form" class="space-y-5">
                <div>
                    <label class="block text-gray-700 font-medium mb-3">Tipo operazione</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="flex items-center justify-center p-3 border-2 border-green-300 bg-green-50 rounded-lg cursor-pointer hover:bg-green-100 transition-colors">
                            <input type="radio" name="update_type" value="add" checked class="mr-2 text-green-500 focus:ring-green-500">
                            <i class="fas fa-plus-circle text-green-600 mr-2"></i>
                            Aggiungi
                        </label>
                        <label class="flex items-center justify-center p-3 border-2 border-red-300 bg-red-50 rounded-lg cursor-pointer hover:bg-red-100 transition-colors">
                            <input type="radio" name="update_type" value="remove" class="mr-2 text-red-500 focus:ring-red-500">
                            <i class="fas fa-minus-circle text-red-600 mr-2"></i>
                            Preleva
                        </label>
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Importo (€)</label>
                    <input type="number" step="0.01" name="update_amount" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 text-center text-lg font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                           placeholder="0.00">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Note (opzionale)</label>
                    <input type="text" name="update_notes" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                           placeholder="Es: DCA mensile, Realizzo profitti...">
                </div>
                
                <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                    <button type="button" onclick="closeInvestmentUpdateModal()" 
                            class="px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                        Annulla
                    </button>
                    <button type="submit" 
                            class="px-6 py-2.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors">
                        <i class="fas fa-check mr-2"></i>Conferma
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Notification -->
    <div id="notification" class="hidden fixed top-4 right-4 z-50">
        <div class="bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg">
            <i class="fas fa-check-circle mr-2"></i>
            <span id="notification-text">Operazione completata!</span>
        </div>
    </div>

    <!-- Modal Componente Progetto -->
    <div id="project-component-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 overflow-y-auto min-h-screen" style="z-index: 10000 !important;">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl border border-gray-200 mx-auto max-h-[85vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold text-gray-900">
                    <i class="fas fa-plus-circle text-amber-600 mr-2"></i>
                    Aggiungi Componente
                </h3>
                <button onclick="closeProjectComponentModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="project-component-form" class="space-y-5">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-tag text-amber-600 mr-2"></i>Progetto
                    </label>
                    <div id="project-info" class="bg-amber-50 p-3 rounded-lg border border-amber-200">
                        <div class="flex items-center">
                            <span id="project-emoji" class="text-2xl mr-2">🏠</span>
                            <span id="project-name" class="font-medium text-amber-800">Nome Progetto</span>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-cube text-blue-600 mr-2"></i>Nome Componente *
                    </label>
                    <input type="text" name="component_name" required 
                           placeholder="es. Materiali, Manodopera, Permessi..."
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-euro-sign text-green-600 mr-2"></i>Prezzo (€) *
                    </label>
                    <input type="number" step="0.01" name="component_price" required 
                           placeholder="0.00"
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-calendar text-purple-600 mr-2"></i>Data Acquisto
                    </label>
                    <input type="date" name="component_date" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-sticky-note text-gray-600 mr-2"></i>Note (opzionale)
                    </label>
                    <textarea name="component_notes" rows="2"
                              placeholder="Descrizione aggiuntiva..."
                              class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none resize-none"></textarea>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button type="button" onclick="closeProjectComponentModal()"
                            class="flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                        <i class="fas fa-times mr-2"></i>Annulla
                    </button>
                    <button type="submit" 
                            class="flex-1 px-4 py-2.5 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-medium transition-colors">
                        <i class="fas fa-plus mr-2"></i>Aggiungi
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Rientro Progetto -->
    <div id="project-return-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 overflow-y-auto min-h-screen" style="z-index: 10000 !important;">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl border border-gray-200 mx-auto max-h-[85vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold text-gray-900">
                    <i class="fas fa-arrow-down text-green-600 mr-2"></i>
                    Rientro Progetto
                </h3>
                <button onclick="closeProjectReturnModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="project-return-form" class="space-y-5">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-project-diagram text-amber-600 mr-2"></i>Progetto
                    </label>
                    <div id="return-project-info" class="bg-amber-50 p-4 rounded-lg border border-amber-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span id="return-project-emoji" class="text-2xl mr-3">🏠</span>
                                <div>
                                    <div id="return-project-name" class="font-medium text-amber-800">Nome Progetto</div>
                                    <div id="return-project-components" class="text-sm text-amber-600"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-amber-200">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Totale Investito:</span>
                                <span id="return-total-invested" class="font-bold text-amber-700">€0.00</span>
                            </div>
                            <div class="flex justify-between items-center mt-1">
                                <span class="text-sm text-gray-600">Rientro Attuale:</span>
                                <span id="return-current-amount" class="font-medium text-green-600">€0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-hand-holding-usd text-green-600 mr-2"></i>Nuovo Rientro (€) *
                    </label>
                    <input type="number" step="0.01" name="return_amount" required 
                           placeholder="Inserisci importo rientro..."
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-lg font-medium">
                </div>

                <div id="return-preview" class="hidden bg-green-50 p-4 rounded-lg border border-green-200">
                    <h4 class="font-medium text-green-800 mb-2">
                        <i class="fas fa-calculator mr-2"></i>Anteprima Risultato
                    </h4>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Totale Investito:</span>
                            <span id="preview-invested" class="font-medium">€0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Nuovo Rientro:</span>
                            <span id="preview-return" class="font-medium">€0.00</span>
                        </div>
                        <hr class="border-green-200">
                        <div class="flex justify-between font-bold">
                            <span id="preview-result-label" class="text-gray-800">Risultato Netto:</span>
                            <span id="preview-result-value" class="text-green-600">€0.00</span>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-calendar text-purple-600 mr-2"></i>Data Rientro
                    </label>
                    <input type="date" name="return_date" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none">
                </div>

                <div class="flex space-x-3 pt-4">
                    <button type="button" onclick="closeProjectReturnModal()"
                            class="flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                        <i class="fas fa-times mr-2"></i>Annulla
                    </button>
                    <button type="submit" 
                            class="flex-1 px-4 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors">
                        <i class="fas fa-check mr-2"></i>Conferma
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 🔒 Sistema Sicurezza e Login -->
    <div id="security-overlay" class="fixed inset-0 bg-gray-900/95 backdrop-blur-sm flex items-center justify-center" style="z-index: 9999 !important; position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; overflow: hidden !important;">
        <div class="bg-slate-800/90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl border border-slate-600/50 max-w-md w-full mx-4">
            <!-- Logo e Titolo -->
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">🐸</div>
                <h1 class="animated-logo">SAPO TRACKER</h1>
                <p class="text-slate-400">Sistema Sicuro di Gestione Finanze</p>
            </div>

            <!-- Setup Password (prima volta) -->
            <div id="setup-password" class="hidden">
                <h2 class="text-xl font-semibold text-white mb-4">🔐 Configura Password</h2>
                <p class="text-slate-300 mb-6 text-sm">Crea una password per proteggere i tuoi dati finanziari. Verrà utilizzata per crittografare tutte le informazioni.</p>
                <form id="setup-form" class="space-y-4">
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-2">Password</label>
                        <input type="password" id="setup-password-input" 
                               class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                               placeholder="Inserisci password sicura" required minlength="6">
                    </div>
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-2">Conferma Password</label>
                        <input type="password" id="setup-confirm-input"
                               class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                               placeholder="Conferma password" required minlength="6">
                    </div>
                    <div class="flex items-start space-x-2 mt-4">
                        <input type="checkbox" id="security-terms" class="mt-1" required>
                        <label for="security-terms" class="text-slate-300 text-xs">
                            Comprendo che questa password protegge i miei dati finanziari e non può essere recuperata se dimenticata.
                        </label>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-purple-600 text-white py-3 px-4 rounded-xl font-semibold hover:from-cyan-600 hover:to-purple-700 transition-all duration-300">
                        🔐 Imposta Password
                    </button>
                </form>
            </div>

            <!-- Login Password -->
            <div id="login-password">
                <h2 class="text-xl font-semibold text-white mb-4">🔑 Accedi</h2>
                <p class="text-slate-300 mb-6 text-sm">Inserisci la password per accedere ai tuoi dati finanziari crittografati.</p>
                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-slate-300 text-sm font-medium mb-2">Password</label>
                        <input type="password" id="login-password-input"
                               class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                               placeholder="Inserisci la tua password" required>
                    </div>
                    <div id="login-error" class="hidden text-red-400 text-sm bg-red-900/20 p-3 rounded-lg border border-red-500/30">
                        ❌ Password incorretta. Riprova.
                    </div>
                    <div class="flex flex-col space-y-3">
                        <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-purple-600 text-white py-3 px-4 rounded-xl font-semibold hover:from-cyan-600 hover:to-purple-700 transition-all duration-300">
                            🔑 Accedi
                        </button>
                        <button type="button" id="reset-app-btn" class="w-full bg-red-600/20 text-red-400 py-2 px-4 rounded-xl text-sm border border-red-500/30 hover:bg-red-600/30 transition-all duration-300">
                            🗑️ Reset Completo App
                        </button>
                    </div>
                </form>
            </div>

            <!-- Session Info -->
            <div class="mt-6 text-center">
                <p class="text-slate-500 text-xs">
                    🔒 Sessione scade automaticamente dopo 30 minuti di inattività
                </p>
            </div>
        </div>
    </div>

    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="hidden fixed bottom-4 left-4 right-4 bg-gradient-to-r from-cyan-500 to-purple-600 text-white p-4 rounded-xl shadow-lg z-40 mx-auto max-w-md">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="text-2xl">📱</div>
                <div>
                    <p class="font-semibold text-sm">Installa App</p>
                    <p class="text-xs opacity-90">Aggiungi alla home per accesso rapido</p>
                </div>
            </div>
            <div class="flex space-x-2">
                <button id="pwa-install-btn" class="bg-white/20 px-3 py-1 rounded-lg text-xs font-medium hover:bg-white/30 transition-colors">
                    Installa
                </button>
                <button id="pwa-dismiss-btn" class="bg-white/10 px-2 py-1 rounded-lg text-xs hover:bg-white/20 transition-colors">
                    ✕
                </button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    
    <!-- 🔐 Security & PWA Scripts -->
    <script>
    // 🛡️ SISTEMA DI SICUREZZA E CRITTOGRAFIA
    class SecurityManager {
        constructor() {
            this.sessionTimeout = 30 * 60 * 1000; // 30 minuti
            this.sessionTimer = null;
            this.isAuthenticated = false;
            this.currentPassword = null;
            
            // Bind methods per evitare problemi di contesto
            this.handlePasswordSetup = this.handlePasswordSetup.bind(this);
            this.handleLogin = this.handleLogin.bind(this);
            this.handleAppReset = this.handleAppReset.bind(this);
            
            this.initSecurity();
            this.setupSessionTimeout();
        }

        async initSecurity() {
            console.log('🔒 Inizializzando sistema sicurezza...');
            
            // Verifica che CryptoJS sia disponibile
            if (typeof CryptoJS === 'undefined') {
                console.error('❌ CryptoJS non caricato!');
                alert('Errore: Libreria crittografia non disponibile. Ricarica la pagina.');
                return;
            }
            console.log('✅ CryptoJS caricato correttamente');
            
            // Blocca immediatamente lo scroll del body
            document.body.classList.add('security-locked');
            
            // Assicurati che l'overlay sia visibile sopra tutto
            const overlay = document.getElementById('security-overlay');
            if (!overlay) {
                console.error('❌ Security overlay non trovato!');
                return;
            }
            overlay.style.display = 'flex';
            
            const hasPassword = this.hasPasswordSet();
            console.log('🔍 Password già impostata:', hasPassword);
            
            if (!hasPassword) {
                console.log('👤 Mostrando setup password...');
                this.showSetupPassword();
            } else {
                console.log('🔑 Mostrando login...');
                this.showLogin();
            }
            
            this.bindEvents();
        }

        hasPasswordSet() {
            return localStorage.getItem('sapo_security_hash') !== null;
        }

        showSetupPassword() {
            document.getElementById('setup-password').classList.remove('hidden');
            document.getElementById('login-password').classList.add('hidden');
            
            // Auto-focus sul primo campo
            setTimeout(() => {
                document.getElementById('setup-password-input')?.focus();
            }, 100);
        }

        showLogin() {
            document.getElementById('setup-password').classList.add('hidden');
            document.getElementById('login-password').classList.remove('hidden');
            
            // Auto-focus sul campo password
            setTimeout(() => {
                document.getElementById('login-password-input')?.focus();
            }, 100);
        }

        bindEvents() {
            // Usa event delegation per evitare problemi di timing
            document.addEventListener('submit', (e) => {
                if (e.target.id === 'setup-form') {
                    e.preventDefault();
                    console.log('📝 Setup form submitted');
                    this.handlePasswordSetup();
                }
                if (e.target.id === 'login-form') {
                    e.preventDefault();
                    console.log('🔑 Login form submitted');
                    this.handleLogin();
                }
            });

            // Reset app con verifica
            document.addEventListener('click', (e) => {
                if (e.target.id === 'reset-app-btn') {
                    console.log('🗑️ Reset button clicked');
                    this.handleAppReset();
                }
            });

            // Auto-logout su inattività
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
                document.addEventListener(event, () => this.resetSessionTimeout(), true);
            });
        }

        async handlePasswordSetup() {
            const password = document.getElementById('setup-password-input').value;
            const confirm = document.getElementById('setup-confirm-input').value;
            
            console.log('🔍 DEBUG SETUP:');
            console.log('   Password:', password);
            console.log('   Conferma:', confirm);
            console.log('   Length:', password.length);
            
            if (password !== confirm) {
                alert('❌ Le password non corrispondono!');
                return;
            }

            if (password.length < 6) {
                alert('❌ La password deve essere di almeno 6 caratteri!');
                return;
            }

            // Crea hash della password
            const passwordHash = CryptoJS.SHA256(password).toString();
            console.log('   Hash generato:', passwordHash);
            
            localStorage.setItem('sapo_security_hash', passwordHash);
            console.log('   Hash salvato in localStorage');
            
            this.currentPassword = password;
            this.isAuthenticated = true;
            
            console.log('✅ Setup completato - nascondendo overlay...');
            this.hideSecurityOverlay();
            
            // Cripta dati esistenti se presenti
            await this.encryptExistingData();
            
            // INIZIALIZZA L'APP DOPO IL LOGIN
            console.log('🚀 Inizializzando app...');
            if (window.initializeFinanceApp) {
                window.initializeFinanceApp();
            } else {
                console.error('❌ initializeFinanceApp non trovata!');
            }
            
            console.log('✅ Password impostata e dati crittografati');
        }

        async handleLogin() {
            try {
                const password = document.getElementById('login-password-input').value;
                const storedHash = localStorage.getItem('sapo_security_hash');
                
                console.log('🔍 DEBUG LOGIN:');
                console.log('   Password inserita:', password);
                console.log('   Password length:', password.length);
                console.log('   Hash salvato:', storedHash);
                
                if (!password) {
                    console.log('❌ Password vuota!');
                    document.getElementById('login-error').classList.remove('hidden');
                    return;
                }
                
                if (!storedHash) {
                    console.log('❌ Nessun hash salvato! Vai al setup.');
                    this.showSetupPassword();
                    return;
                }
                
                const passwordHash = CryptoJS.SHA256(password).toString();
                console.log('   Hash calcolato:', passwordHash);
                console.log('   Hash match:', passwordHash === storedHash);
                
                if (passwordHash === storedHash) {
                    console.log('✅ Password corretta! Procedendo con login...');
                    
                    this.currentPassword = password;
                    this.isAuthenticated = true;
                    
                    // FORZA NASCONDERE L'OVERLAY IMMEDIATAMENTE
                    console.log('🔒 Step 1: Nascondendo overlay...');
                    const overlay = document.getElementById('security-overlay');
                    if (overlay) {
                        overlay.style.display = 'none';
                        overlay.style.visibility = 'hidden';
                        overlay.classList.add('hidden');
                        console.log('✅ Overlay nascosto');
                    }
                    
                    // RIPRISTINA SCROLL BODY
                    console.log('🔒 Step 2: Ripristinando scroll...');
                    document.body.classList.remove('security-locked');
                    document.body.style.overflow = '';
                    document.body.style.position = '';
                    document.body.style.width = '';
                    document.body.style.height = '';
                    console.log('✅ Scroll ripristinato');
                    
                    // NASCONDI ERRORI
                    const errorElement = document.getElementById('login-error');
                    if (errorElement) {
                        errorElement.classList.add('hidden');
                    }
                    
                    // DECRITTA DATI
                    console.log('🔒 Step 3: Decrittando dati...');
                    await this.decryptData();
                    console.log('✅ Dati decrittografati');
                    
                    // INIZIALIZZA L'APP
                    console.log('🚀 Step 4: Inizializzando app...');
                    if (window.initializeFinanceApp) {
                        await window.initializeFinanceApp();
                        console.log('✅ App inizializzata');
                    } else {
                        console.error('❌ initializeFinanceApp non trovata!');
                    }
                    
                    // RESET SESSION TIMEOUT
                    this.resetSessionTimeout();
                    
                    console.log('🎉 LOGIN COMPLETATO CON SUCCESSO!');
                    
                } else {
                    console.log('❌ Login failed - password non corrisponde');
                    const errorElement = document.getElementById('login-error');
                    if (errorElement) {
                        errorElement.classList.remove('hidden');
                    }
                    document.getElementById('login-password-input').value = '';
                }
                
            } catch (error) {
                console.error('❌ ERRORE DURANTE LOGIN:', error);
                alert('Errore durante il login. Controlla la console per dettagli.');
            }
        }

        hideSecurityOverlay() {
            console.log('🔒 hideSecurityOverlay() chiamato...');
            
            const overlay = document.getElementById('security-overlay');
            if (overlay) {
                // Molteplici metodi per assicurarsi che sparisca
                overlay.style.display = 'none';
                overlay.style.visibility = 'hidden';
                overlay.style.opacity = '0';
                overlay.classList.add('hidden');
                overlay.setAttribute('hidden', 'true');
                console.log('✅ Overlay nascosto con tutti i metodi');
            } else {
                console.error('❌ Overlay non trovato!');
            }
            
            // Ripristina lo scroll del body con tutti i metodi
            document.body.classList.remove('security-locked');
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            document.body.style.height = '';
            console.log('✅ Body scroll ripristinato');
            
            this.resetSessionTimeout();
        }

        setupSessionTimeout() {
            this.resetSessionTimeout();
        }

        resetSessionTimeout() {
            if (!this.isAuthenticated) return;
            
            clearTimeout(this.sessionTimer);
            this.sessionTimer = setTimeout(() => {
                this.logout();
            }, this.sessionTimeout);
        }

        logout() {
            this.isAuthenticated = false;
            this.currentPassword = null;
            
            // Blocca di nuovo lo scroll
            document.body.classList.add('security-locked');
            
            // Mostra overlay
            const overlay = document.getElementById('security-overlay');
            overlay.style.display = 'flex';
            
            this.showLogin();
            
            // Pulisci dati sensibili dalla memoria
            if (window.financeApp && window.financeApp.clearSensitiveData) {
                window.financeApp.clearSensitiveData();
            }
            
            console.log('🔒 Session expired - logged out');
        }

        // Critta una stringa
        encrypt(data) {
            if (!this.currentPassword || !this.isAuthenticated) {
                throw new Error('Utente non autenticato');
            }
            
            return CryptoJS.AES.encrypt(JSON.stringify(data), this.currentPassword).toString();
        }

        // Decritta una stringa  
        decrypt(encryptedData) {
            if (!this.currentPassword || !this.isAuthenticated) {
                throw new Error('Utente non autenticato');
            }
            
            try {
                const bytes = CryptoJS.AES.decrypt(encryptedData, this.currentPassword);
                return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
            } catch (error) {
                console.error('❌ Decryption failed:', error);
                return null;
            }
        }

        // Salva dati crittografati
        setSecureItem(key, data) {
            if (!this.isAuthenticated) return false;
            
            try {
                const encrypted = this.encrypt(data);
                localStorage.setItem(`sapo_secure_${key}`, encrypted);
                return true;
            } catch (error) {
                console.error('❌ Secure storage failed:', error);
                return false;
            }
        }

        // Recupera dati decrittografati
        getSecureItem(key) {
            if (!this.isAuthenticated) return null;
            
            const encrypted = localStorage.getItem(`sapo_secure_${key}`);
            if (!encrypted) return null;
            
            return this.decrypt(encrypted);
        }

        // Migra dati esistenti alla versione crittografata
        async encryptExistingData() {
            const keysToEncrypt = [
                'sapoInvestmentsData',
                'sapoTransactionsCache',
                'sapoAppSettings'
            ];

            for (const key of keysToEncrypt) {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        this.setSecureItem(key.replace('sapo', ''), parsed);
                        localStorage.removeItem(key); // Rimuovi versione non crittografata
                        console.log(`✅ Migrated ${key} to encrypted storage`);
                    } catch (error) {
                        console.warn(`⚠️ Failed to migrate ${key}:`, error);
                    }
                }
            }
        }

        // Decritta dati all'avvio
        async decryptData() {
            // I dati verranno decrittografati on-demand dalle funzioni dell'app
            console.log('🔓 Data decryption ready');
        }

        // Reset completo app
        handleAppReset() {
            const confirm = window.confirm(
                '⚠️ ATTENZIONE!\n\n' +
                'Questa operazione cancellerà TUTTI i dati:\n' +
                '• Password di accesso\n' +
                '• Tutte le transazioni\n' +
                '• Tutti gli investimenti\n' +
                '• Impostazioni salvate\n\n' +
                'Questa operazione NON PUÒ essere annullata!\n\n' +
                'Sei sicuro di voler continuare?'
            );
            
            if (confirm) {
                // Cancella tutto dal localStorage
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('sapo')) {
                        localStorage.removeItem(key);
                    }
                });
                
                alert('🗑️ App resettata completamente!\n\nLa pagina verrà ricaricata.');
                window.location.reload();
            }
        }
    }

    // 📱 PWA MANAGER
    class PWAManager {
        constructor() {
            this.deferredPrompt = null;
            this.init();
        }

        init() {
            // Service Worker Registration
            this.registerServiceWorker();
            
            // Install prompt handling
            this.setupInstallPrompt();
            
            // Notification permission
            this.requestNotificationPermission();
        }

        async registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('✅ Service Worker registered:', registration.scope);
                    
                    // Listen for updates
                    registration.addEventListener('updatefound', () => {
                        console.log('🔄 Service Worker update found');
                    });
                } catch (error) {
                    console.error('❌ Service Worker registration failed:', error);
                }
            }
        }

        setupInstallPrompt() {
            // Show install banner
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                this.deferredPrompt = e;
                this.showInstallBanner();
            });

            // Install button click
            document.getElementById('pwa-install-btn')?.addEventListener('click', () => {
                this.handleInstallClick();
            });

            // Dismiss button click  
            document.getElementById('pwa-dismiss-btn')?.addEventListener('click', () => {
                this.hideInstallBanner();
            });

            // App installed
            window.addEventListener('appinstalled', () => {
                console.log('✅ PWA installed successfully');
                this.hideInstallBanner();
            });
        }

        showInstallBanner() {
            document.getElementById('pwa-install-banner')?.classList.remove('hidden');
        }

        hideInstallBanner() {
            document.getElementById('pwa-install-banner')?.classList.add('hidden');
        }

        async handleInstallClick() {
            if (!this.deferredPrompt) return;
            
            this.deferredPrompt.prompt();
            const result = await this.deferredPrompt.userChoice;
            
            console.log('PWA install result:', result.outcome);
            this.deferredPrompt = null;
            this.hideInstallBanner();
        }

        async requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                console.log('Notification permission:', permission);
                
                if (permission === 'granted') {
                    this.scheduleNotifications();
                }
            }
        }

        scheduleNotifications() {
            // Programma reminder giornalieri (se supportato)
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'SCHEDULE_NOTIFICATION',
                    interval: 24 // 24 ore
                });
            }
        }
    }

    // 🎯 TOUCH GESTURES MANAGER  
    class GestureManager {
        constructor() {
            this.touchStartX = 0;
            this.touchStartY = 0;
            this.touchEndX = 0;
            this.touchEndY = 0;
            this.minSwipeDistance = 50;
            
            this.bindGestures();
        }

        bindGestures() {
            // Touch events per swipe
            document.addEventListener('touchstart', (e) => {
                this.touchStartX = e.changedTouches[0].screenX;
                this.touchStartY = e.changedTouches[0].screenY;
            });

            document.addEventListener('touchend', (e) => {
                this.touchEndX = e.changedTouches[0].screenX;
                this.touchEndY = e.changedTouches[0].screenY;
                this.handleSwipe();
            });

            // Long press per azioni rapide
            this.setupLongPress();
        }

        handleSwipe() {
            const deltaX = this.touchEndX - this.touchStartX;
            const deltaY = this.touchEndY - this.touchStartY;
            
            // Controlla se è uno swipe orizzontale valido
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > this.minSwipeDistance) {
                if (deltaX > 0) {
                    this.onSwipeRight();
                } else {
                    this.onSwipeLeft();
                }
            }
            
            // Controlla se è uno swipe verticale valido
            if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > this.minSwipeDistance) {
                if (deltaY > 0) {
                    this.onSwipeDown();
                } else {
                    this.onSwipeUp();
                }
            }
        }

        onSwipeLeft() {
            // Swipe left: Apri modal entrata
            console.log('👆 Swipe Left: Quick Income');
            if (window.financeApp && window.financeApp.openTransactionModal) {
                window.financeApp.openTransactionModal('income');
            }
        }

        onSwipeRight() {
            // Swipe right: Apri modal spesa
            console.log('👆 Swipe Right: Quick Expense');
            if (window.financeApp && window.financeApp.openTransactionModal) {
                window.financeApp.openTransactionModal('expense');
            }
        }

        onSwipeUp() {
            // Swipe up: Scorri a investimenti
            console.log('👆 Swipe Up: Scroll to investments');
            const investmentsSection = document.querySelector('#investments-section');
            if (investmentsSection) {
                investmentsSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        onSwipeDown() {
            // Swipe down: Scorri in alto
            console.log('👆 Swipe Down: Scroll to top');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        setupLongPress() {
            let longPressTimer;
            const longPressDuration = 800; // 800ms

            document.addEventListener('touchstart', (e) => {
                longPressTimer = setTimeout(() => {
                    this.onLongPress(e);
                }, longPressDuration);
            });

            document.addEventListener('touchend', () => {
                clearTimeout(longPressTimer);
            });

            document.addEventListener('touchmove', () => {
                clearTimeout(longPressTimer);
            });
        }

        onLongPress(e) {
            // Vibrazione se supportata
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }

            console.log('👆 Long Press: Quick actions menu');
            // Mostra menu azioni rapide
            this.showQuickActionsMenu(e);
        }

        showQuickActionsMenu(e) {
            // Crea menu contestuale per azioni rapide
            const existingMenu = document.getElementById('quick-actions-menu');
            if (existingMenu) existingMenu.remove();

            const menu = document.createElement('div');
            menu.id = 'quick-actions-menu';
            menu.className = 'fixed bg-slate-800/95 backdrop-blur-md rounded-xl p-4 shadow-2xl border border-slate-600/50 z-50';
            
            const touch = e.changedTouches[0];
            menu.style.left = `${Math.min(touch.clientX, window.innerWidth - 200)}px`;
            menu.style.top = `${Math.max(touch.clientY - 100, 20)}px`;

            menu.innerHTML = `
                <div class="text-white text-sm font-medium mb-3">⚡ Azioni Rapide</div>
                <div class="space-y-2">
                    <button onclick="quickAction('income')" class="flex items-center space-x-2 w-full p-2 text-left text-green-400 hover:bg-green-500/20 rounded-lg transition-colors">
                        <span>💚</span><span>Entrata Rapida</span>
                    </button>
                    <button onclick="quickAction('expense')" class="flex items-center space-x-2 w-full p-2 text-left text-red-400 hover:bg-red-500/20 rounded-lg transition-colors">
                        <span>❤️</span><span>Spesa Rapida</span>
                    </button>
                    <button onclick="quickAction('investment')" class="flex items-center space-x-2 w-full p-2 text-left text-blue-400 hover:bg-blue-500/20 rounded-lg transition-colors">
                        <span>💎</span><span>Investimento</span>
                    </button>
                </div>
            `;

            document.body.appendChild(menu);

            // Auto-remove dopo 3 secondi
            setTimeout(() => {
                if (menu.parentNode) menu.remove();
            }, 3000);

            // Remove al click fuori
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 100);
        }
    }

    // Funzioni globali per azioni rapide
    window.quickAction = function(type) {
        document.getElementById('quick-actions-menu')?.remove();
        
        if (window.financeApp) {
            switch(type) {
                case 'income':
                case 'expense':
                    window.financeApp.openTransactionModal(type);
                    break;
                case 'investment':
                    document.querySelector('#investments-section')?.scrollIntoView({ behavior: 'smooth' });
                    break;
            }
        }
    };

    // 🎵 Controlli suoni lava lamp
    window.toggleLavaSounds = function() {
        if (window.lavaLampSounds) {
            window.lavaLampSounds.toggle();
        } else {
            console.log('🔇 Sistema suoni non ancora caricato');
        }
    };

    window.playTestSound = function() {
        if (window.lavaLampSounds) {
            window.lavaLampSounds.playClickSound(0);
            console.log('🎵 Suono di test riprodotto');
        }
    };

    window.setVolume = function(volume) {
        if (window.lavaLampSounds && volume >= 0 && volume <= 1) {
            window.lavaLampSounds.masterVolume = volume;
            console.log(`🔊 Volume impostato a: ${Math.round(volume * 100)}%`);
        }
    };

    // 🧪 FUNZIONE TEST SISTEMA PASSWORD
    window.testPasswordSystem = function() {
        console.log('🧪 TEST PASSWORD SYSTEM:');
        
        // Test 1: Verifica elementi DOM
        const setupForm = document.getElementById('setup-form');
        const loginForm = document.getElementById('login-form');
        const overlay = document.getElementById('security-overlay');
        
        console.log('   Setup Form:', setupForm ? '✅ Trovato' : '❌ Non trovato');
        console.log('   Login Form:', loginForm ? '✅ Trovato' : '❌ Non trovato');
        console.log('   Overlay:', overlay ? '✅ Trovato' : '❌ Non trovato');
        
        // Test 2: Verifica SecurityManager
        console.log('   SecurityManager:', window.securityManager ? '✅ Disponibile' : '❌ Non disponibile');
        
        // Test 3: Verifica CryptoJS
        console.log('   CryptoJS:', typeof CryptoJS !== 'undefined' ? '✅ Caricato' : '❌ Non caricato');
        
        // Test 4: Password già salvata?
        const savedHash = localStorage.getItem('sapo_security_hash');
        console.log('   Hash salvato:', savedHash ? '✅ Presente' : '❌ Assente');
        
        // Test 5: Simula setup password
        if (window.securityManager && !savedHash) {
            console.log('🔧 Test automatico setup password...');
            document.getElementById('setup-password-input').value = 'test123';
            document.getElementById('setup-confirm-input').value = 'test123';
            document.getElementById('security-terms').checked = true;
            
            console.log('   Password inserita: test123');
            console.log('   Ora clicca "Imposta Password" per testare!');
            
            // 🎯 AUTO-LOGIN per test: simula click del pulsante dopo un breve delay
            setTimeout(() => {
                const setupButton = document.querySelector('#setup-password button[type="submit"]');
                if (setupButton && !localStorage.getItem('sapo_security_hash')) {
                    console.log('🤖 AUTO-SETUP: Cliccando automaticamente "Imposta Password"...');
                    setupButton.click();
                }
            }, 1000);
        }
        
        return {
            setupForm: !!setupForm,
            loginForm: !!loginForm,
            overlay: !!overlay,
            securityManager: !!window.securityManager,
            cryptoJS: typeof CryptoJS !== 'undefined',
            savedHash: !!savedHash
        };
    };

    // 🔍 FUNZIONE PER VEDERE LA PASSWORD SALVATA
    window.checkPassword = function() {
        console.log('🔍 CONTROLLO PASSWORD SALVATA:');
        
        const savedHash = localStorage.getItem('sapo_security_hash');
        if (!savedHash) {
            console.log('❌ Nessuna password salvata!');
            console.log('💡 Devi fare il setup della password prima.');
            console.log('🔧 Usa forceSetup() per forzare il setup');
            return null;
        }
        
        console.log('✅ Hash trovato:', savedHash);
        
        // Testa password comuni (più complete)
        const commonPasswords = [
            'test123', 'password', '123456', 'admin', 'sapo', 
            'tracker', 'finanze', '000000', 'test', '12345678',
            'qwerty', 'abc123', 'password123', 'admin123',
            'sapo123', 'tracker123', '111111', '1234', '54321',
            'pass', 'user', 'demo', 'guest', 'temp'
        ];
        
        console.log('🧪 Testando password comuni...');
        
        for (const pwd of commonPasswords) {
            const hash = CryptoJS.SHA256(pwd).toString();
            if (hash === savedHash) {
                console.log(`🎉 TROVATA! La password è: "${pwd}"`);
                console.log(`🚀 Usa autoLogin("${pwd}") per accedere automaticamente!`);
                return pwd;
            }
        }
        
        console.log('❌ Password non trovata tra quelle comuni');
        console.log('💡 Opzioni disponibili:');
        console.log('   1. emergencyReset() - Cancella tutto e ricomincia');
        console.log('   2. bypassSecurity() - Bypass temporaneo per debug');
        console.log('   3. Prova a ricordare la password manualmente');
        
        return null;
    };

    // 🚀 FUNZIONE AUTO-LOGIN CON PASSWORD TROVATA
    window.autoLogin = function(password) {
        if (!password) {
            password = window.checkPassword();
        }
        
        if (password) {
            console.log(`🚀 Tentativo auto-login con: "${password}"`);
            
            const passwordInput = document.getElementById('login-password-input');
            if (passwordInput) {
                passwordInput.value = password;
                console.log('✅ Password inserita automaticamente');
                console.log('👆 Ora clicca "Accedi" o premi Invio');
            } else {
                console.log('❌ Campo password non trovato');
            }
        }
    };

    // 🗑️ FUNZIONE RESET RAPIDO (per emergenza)
    window.emergencyReset = function() {
        const confirm1 = window.confirm('⚠️ RESET EMERGENZA\n\nQuesta operazione cancellerà TUTTO:\n- Password\n- Transazioni\n- Investimenti\n\nContinuare?');
        
        if (confirm1) {
            const confirm2 = window.confirm('🚨 ULTIMA CONFERMA\n\nSei SICURO di voler cancellare tutto?\nQuesta operazione NON può essere annullata!');
            
            if (confirm2) {
                // Cancella tutto
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('sapo')) {
                        localStorage.removeItem(key);
                    }
                });
                
                console.log('🗑️ Reset completato!');
                alert('✅ Reset completato!\n\nLa pagina verrà ricaricata.');
                window.location.reload();
            }
        }
    };

    // 🔍 FUNZIONE DEBUG COMPLETO STATO
    window.debugState = function() {
        console.log('🔍 DEBUG STATO COMPLETO:');
        
        // Verifica localStorage
        console.log('📦 LOCALSTORAGE:');
        Object.keys(localStorage).forEach(key => {
            if (key.includes('sapo') || key.includes('security')) {
                console.log(`   ${key}: ${localStorage.getItem(key)}`);
            }
        });
        
        // Verifica elementi DOM
        console.log('🖥️ DOM ELEMENTS:');
        const setupDiv = document.getElementById('setup-password');
        const loginDiv = document.getElementById('login-password');
        const overlay = document.getElementById('security-overlay');
        
        console.log(`   Setup div hidden: ${setupDiv?.classList.contains('hidden')}`);
        console.log(`   Login div hidden: ${loginDiv?.classList.contains('hidden')}`);
        console.log(`   Overlay display: ${overlay?.style.display}`);
        
        // Verifica SecurityManager
        console.log('🔒 SECURITY MANAGER:');
        if (window.securityManager) {
            console.log(`   isAuthenticated: ${window.securityManager.isAuthenticated}`);
            console.log(`   currentPassword: ${window.securityManager.currentPassword ? '[SET]' : '[NOT SET]'}`);
        }
    };

    // 🚀 FUNZIONE FORZA SETUP
    window.forceSetup = function() {
        console.log('🔧 Forzando visualizzazione setup...');
        if (window.securityManager) {
            window.securityManager.showSetupPassword();
        }
    };

    // 🚀 FUNZIONE FORZA LOGIN  
    window.forceLogin = function() {
        console.log('🔧 Forzando visualizzazione login...');
        if (window.securityManager) {
            window.securityManager.showLogin();
        }
    };

    // 🔓 BYPASS TEMPORANEO (solo per debug)
    window.bypassSecurity = function() {
        console.log('🚨 BYPASS SICUREZZA TEMPORANEO (SOLO PER DEBUG)');
        
        if (window.securityManager) {
            window.securityManager.isAuthenticated = true;
            window.securityManager.currentPassword = 'bypass';
            window.securityManager.hideSecurityOverlay();
            
            if (window.initializeFinanceApp) {
                window.initializeFinanceApp();
            }
            
            console.log('✅ Bypass attivato - app caricata');
            console.log('⚠️ RICORDA: Questo è solo per debug, imposta una password vera!');
        }
    };

    // 🚨 FORZA USCITA OVERLAY (per il problema specifico)
    window.forceHideOverlay = function() {
        console.log('🚨 FORZA USCITA DALL\'OVERLAY...');
        
        // Metodo 1: Via SecurityManager
        if (window.securityManager) {
            window.securityManager.hideSecurityOverlay();
        }
        
        // Metodo 2: Diretto DOM
        const overlay = document.getElementById('security-overlay');
        if (overlay) {
            overlay.style.display = 'none !important';
            overlay.style.visibility = 'hidden !important';
            overlay.style.opacity = '0 !important';
            overlay.classList.add('hidden');
            overlay.remove(); // Rimuove completamente dall'DOM
            console.log('✅ Overlay rimosso forzatamente');
        }
        
        // Metodo 3: Ripristina body
        document.body.classList.remove('security-locked');
        document.body.style.cssText = ''; // Reset tutti gli stili
        console.log('✅ Body ripristinato');
        
        // Metodo 4: Inizializza app se non già fatto
        if (!window.financeApp && window.initializeFinanceApp) {
            window.initializeFinanceApp();
            console.log('✅ App inizializzata forzatamente');
        }
        
        console.log('🎉 OVERLAY FORZATAMENTE RIMOSSO!');
    };

    // 🧪 FUNZIONE TEST LOGIN AUTOMATICO
    window.testLogin = function(password = null) {
        console.log('🧪 TEST LOGIN AUTOMATICO...');
        
        if (!password) {
            // Prova password comuni
            const commonPasswords = ['test123', 'password', '123456', 'admin'];
            for (const pwd of commonPasswords) {
                const hash = CryptoJS.SHA256(pwd).toString();
                const saved = localStorage.getItem('sapo_security_hash');
                if (hash === saved) {
                    password = pwd;
                    break;
                }
            }
        }
        
        if (!password) {
            console.log('❌ Nessuna password trovata per il test');
            return;
        }
        
        console.log(`🔑 Testando login con password: "${password}"`);
        
        // Inserisci password
        const input = document.getElementById('login-password-input');
        if (input) {
            input.value = password;
            console.log('✅ Password inserita nel campo');
            
            // Simula submit
            const form = document.getElementById('login-form');
            if (form) {
                form.dispatchEvent(new Event('submit'));
                console.log('✅ Form submit simulato');
            }
        }
    };

    // Sistema di inizializzazione pulito

    // 📱 MOBILE PERFORMANCE DETECTION E OTTIMIZZAZIONE
    class MobileOptimizer {
        constructor() {
            this.isMobile = window.innerWidth <= 768;
            this.isLowEnd = this.detectLowEndDevice();
            this.init();
        }
        
        detectLowEndDevice() {
            // Rileva dispositivi con poca RAM o CPU
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            const slowConnection = connection && (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g');
            const lowRam = navigator.deviceMemory && navigator.deviceMemory < 4;
            const oldDevice = navigator.userAgent.includes('Android 4') || navigator.userAgent.includes('Android 5');
            
            return slowConnection || lowRam || oldDevice;
        }
        
        init() {
            if (this.isMobile) {
                console.log('📱 Modalità mobile attivata');
                this.optimizeForMobile();
            }
            
            if (this.isLowEnd) {
                console.log('🔋 Modalità low-end attivata');
                this.enableLowEndMode();
            }
        }
        
        optimizeForMobile() {
            // Disabilita animazioni CSS pesanti
            const style = document.createElement('style');
            style.innerHTML = `
                * {
                    animation: none !important;
                    transition: none !important;
                }
                .lava-lamp-container { display: none !important; }
                .particle-system { display: none !important; }
            `;
            document.head.appendChild(style);
            
            // Riduce qualità chart per performance
            if (window.Chart) {
                Chart.defaults.animation = false;
                Chart.defaults.responsive = true;
                Chart.defaults.maintainAspectRatio = false;
            }
        }
        
        enableLowEndMode() {
            // Modalità ultra-leggera per dispositivi vecchi
            document.body.style.background = '#1e293b';
            
            // Rimuove tutti gli effetti
            const elementsToSimplify = document.querySelectorAll('.card, .chart-container, input, select, button');
            elementsToSimplify.forEach(el => {
                el.style.boxShadow = 'none';
                el.style.backdropFilter = 'none';
                el.style.filter = 'none';
                el.style.background = 'rgba(30, 41, 59, 0.8)';
            });
            
            // Notifica utente delle ottimizzazioni
            console.log('🔋 Low-end optimizations applied');
            
            // Mostra messaggio informativo (non invasivo)
            setTimeout(() => {
                if (document.getElementById('security-overlay').classList.contains('hidden')) {
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed; 
                        bottom: 20px; 
                        left: 20px; 
                        right: 20px; 
                        background: rgba(34, 197, 94, 0.9); 
                        color: white; 
                        padding: 12px; 
                        border-radius: 8px; 
                        font-size: 14px; 
                        text-align: center; 
                        z-index: 1000;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                    `;
                    notification.innerHTML = '📱 Modalità ottimizzata attivata per migliori performance';
                    document.body.appendChild(notification);
                    
                    setTimeout(() => notification.remove(), 3000);
                }
            }, 2000);
        }
    }
    
    // 🚀 INIZIALIZZAZIONE SISTEMA
    document.addEventListener('DOMContentLoaded', () => {
        console.log('🔒 Inizializzazione sistema sicurezza...');
        
        // 📱 ATTIVA OTTIMIZZAZIONI MOBILE PRIMA DI TUTTO
        window.mobileOptimizer = new MobileOptimizer();
        
        // 🚀 MOBILE PERFORMANCE: Ritarda inizializzazione se necessario
        const isMobileDevice = window.innerWidth <= 768;
        const initDelay = isMobileDevice ? 500 : 0; // Ritardo su mobile per evitare freeze
        
        setTimeout(() => {
            // PRIMA: Inizializza il sistema di sicurezza
            window.securityManager = new SecurityManager();
        
        // DOPO: Inizializza altri manager (non dipendenti da autenticazione)
        window.pwaManager = new PWAManager();
        
        // 📱 MOBILE: Inizializza gesture manager solo se necessario
        if (!isMobileDevice || !window.mobileOptimizer.isLowEnd) {
            window.gestureManager = new GestureManager();
        }
        
        // 🔊 SISTEMA SUONI: Solo su desktop o device potenti
        if (!isMobileDevice) {
            setTimeout(() => {
                // TODO: Implementare LavaLampSoundManager quando necessario
                // window.lavaLampSounds = new LavaLampSoundManager();
                console.log('🎵 Sistema suoni lava lamp temporaneamente disabilitato');
            }, 1000);
        } else {
            console.log('📱 Suoni lava lamp disabilitati su mobile per performance');
        }
        
        console.log('🚀 Sistema Enhanced pronto:');
        console.log('   🔒 Security & Encryption (ATTIVO)');
        console.log('   📱 PWA Support');  
        console.log('   👆 Touch Gestures');
        console.log('   💾 Offline Mode');
        console.log('   🎵 Lava Lamp Sounds');
        console.log('   📱 Mobile Optimization (ATTIVO)');
        console.log('   ⏳ In attesa di autenticazione...');
        
        // Auto-test dopo 2 secondi (solo su desktop)
        if (!isMobileDevice) {
            setTimeout(() => {
                console.log('🧪 Eseguendo auto-test del sistema...');
                window.testPasswordSystem();
                
                // 🧪 TEST CHIUSURA MODAL - Verifica funzionamento
                window.testModalClosure = () => {
                    console.log('🧪 TESTANDO SISTEMA CHIUSURA MODAL...');
                    
                    try {
                        // Testa funzioni disponibili
                        if (typeof openAddModal === 'function') {
                            console.log('✅ openAddModal disponibile');
                        }
                        
                        if (typeof closeAddModal === 'function') {
                            console.log('✅ closeAddModal disponibile');  
                        }
                        
                        if (sapoTracker && typeof sapoTracker.forceCloseAllModals === 'function') {
                            console.log('✅ forceCloseAllModals disponibile');
                        }
                        
                        console.log('🎯 Test completato - Sistema chiusura modal OPERATIVO');
                        return true;
                        
                    } catch (e) {
                        console.error('❌ ERRORE nel test chiusura modal:', e);
                        return false;
                    }
                };
                
                // Esegui il test
                setTimeout(() => window.testModalClosure(), 1000);
                
                // 🎨 TEST CONTRASTO MODAL - Verifica leggibilità
                window.testModalContrast = () => {
                    console.log('🎨 TESTANDO CONTRASTO MODAL...');
                    
                    const modalIds = ['add-modal', 'quick-expense-modal', 'investment-modal', 'investment-update-modal'];
                    
                    modalIds.forEach(modalId => {
                        const modal = document.getElementById(modalId);
                        if (modal) {
                            const modalContent = modal.querySelector('div');
                            if (modalContent) {
                                const bgColor = getComputedStyle(modalContent).backgroundColor;
                                const textElements = modalContent.querySelectorAll('label, p, h1, h2, h3, h4, h5, h6');
                                
                                console.log(`🎨 Modal ${modalId}:`);
                                console.log(`   Background: ${bgColor}`);
                                console.log(`   Elementi testo: ${textElements.length}`);
                                
                                if (textElements.length > 0) {
                                    const textColor = getComputedStyle(textElements[0]).color;
                                    console.log(`   Text Color: ${textColor}`);
                                }
                            }
                        }
                    });
                    
                    console.log('🎨 Test contrasto completato - Verifica i colori sopra');
                };
                
                // Esegui test contrasto
                setTimeout(() => window.testModalContrast(), 2000);
                
                // 🎨 TEST CONTRASTO INTERFACCIA PRINCIPALE
                window.testMainInterfaceContrast = () => {
                    console.log('🎨 TESTANDO CONTRASTO INTERFACCIA PRINCIPALE...');
                    
                    const sections = [
                        { id: 'transactions-list', name: 'Movimenti Recenti' },
                        { id: 'investments-section', name: 'I Miei Investimenti' },
                        { id: 'frequent-analysis', name: 'Movimenti Frequenti' },
                        { selector: '.chart-wrapper', name: 'Distribuzione Spese' }
                    ];
                    
                    sections.forEach(section => {
                        let element;
                        if (section.id) {
                            element = document.getElementById(section.id);
                        } else if (section.selector) {
                            element = document.querySelector(section.selector);
                        }
                        
                        if (element) {
                            const titles = element.querySelectorAll('h1, h2, h3, h4, h5, h6');
                            const texts = element.querySelectorAll('p, span, div');
                            
                            console.log(`🎨 ${section.name}:`);
                            
                            if (titles.length > 0) {
                                const titleColor = getComputedStyle(titles[0]).color;
                                console.log(`   Titoli (${titles.length}): ${titleColor}`);
                            }
                            
                            if (texts.length > 0) {
                                const textColor = getComputedStyle(texts[0]).color;
                                console.log(`   Testo (${texts.length}): ${textColor}`);
                            }
                        } else {
                            console.log(`❌ Sezione '${section.name}' non trovata`);
                        }
                    });
                    
                    console.log('🎨 Test contrasto interfaccia principale completato');
        

                };
                
                // Esegui test interfaccia dopo il caricamento
                setTimeout(() => window.testMainInterfaceContrast(), 3000);
                
                // 🧪 TEST BOTTONI ENTRATA/USCITA
                window.testTransactionButtons = () => {
                    console.log('🧪 TESTANDO BOTTONI ENTRATA/USCITA...');
                    
                    try {
                        // Trova i bottoni principali
                        const buttons = document.querySelectorAll('button[onclick*="openAddModal"]');
                        console.log(`🎯 Trovati ${buttons.length} bottoni transazione`);
                        
                        buttons.forEach((btn, index) => {
                            const onclick = btn.getAttribute('onclick');
                            const isEntrata = onclick.includes('entrata');
                            const isUscita = onclick.includes('uscita');
                            
                            console.log(`📊 Bottone ${index + 1}:`);
                            console.log(`   Tipo: ${isEntrata ? 'ENTRATA' : isUscita ? 'USCITA' : 'ALTRO'}`);
                            console.log(`   Visibile: ${btn.offsetWidth > 0 && btn.offsetHeight > 0}`);
                            console.log(`   Disabilitato: ${btn.disabled}`);
                            console.log(`   Onclick: ${onclick.substring(0, 50)}...`);
                        });
                        
                        // Test function availability
                        if (typeof openAddModal === 'function') {
                            console.log('✅ Funzione openAddModal disponibile');
                            
                            // 🧪 TEST CHIAMATA FUNZIONE - DISABILITATO PER EVITARE APERTURA AUTOMATICA
                            try {
                                console.log('🧪 Test funzione disponibile ma non eseguito automaticamente');
                                // openAddModal('entrata'); // DISABILITATO
                                console.log('✅ Test funzione disponibilità completato senza aprire modal');
                                
                            } catch (e) {
                                console.error('❌ ERRORE durante test funzione:', e);
                            }
                            
                        } else {
                            console.log('❌ Funzione openAddModal NON disponibile');
                        }
                        
                        console.log('🎯 Test bottoni completato');
                        return true;
                        
                    } catch (e) {
                        console.error('❌ ERRORE nel test bottoni:', e);
                        return false;
                    }
                };
                
                // Esegui test bottoni - DISABILITATO PER EVITARE APERTURA MODAL AUTOMATICA
                // setTimeout(() => window.testTransactionButtons(), 4000);
                
                // 🧪 TEST OVERLAY CLICK-THROUGH
                window.testOverlayClickThrough = () => {
                    console.log('🧪 TESTANDO OVERLAY CLICK-THROUGH...');
                    
                    try {
                        const overlay = document.getElementById('security-overlay');
                        const buttons = document.querySelectorAll('button[onclick*="openAddModal"]');
                        
                        if (overlay) {
                            const overlayStyle = getComputedStyle(overlay);
                            console.log(`🎯 Overlay pointer-events: ${overlayStyle.pointerEvents}`);
                            console.log(`🎯 Overlay z-index: ${overlayStyle.zIndex}`);
                            console.log(`🎯 Overlay visibile: ${overlayStyle.display !== 'none'}`);
                        }
                        
                        if (buttons.length > 0) {
                            buttons.forEach((btn, index) => {
                                const btnRect = btn.getBoundingClientRect();
                                const isVisible = btnRect.width > 0 && btnRect.height > 0;
                                const isInView = btnRect.top >= 0 && btnRect.bottom <= window.innerHeight;
                                
                                console.log(`📊 Bottone ${index + 1}:`);
                                console.log(`   Visibile: ${isVisible}`);
                                console.log(`   In vista: ${isInView}`);
                                console.log(`   Posizione: top=${btnRect.top}, left=${btnRect.left}`);
                            });
                        }
                        
                        console.log('🎯 Test overlay completato - I bottoni dovrebbero essere cliccabili ora!');
                        
                    } catch (e) {
                        console.error('❌ ERRORE nel test overlay:', e);
                    }
                };
                
                // Esegui test overlay
                setTimeout(() => window.testOverlayClickThrough(), 5000);
                
                // 🧪 TEST CLICK REALE - Simula esattamente il click dell'utente
                window.testRealClick = () => {
                    console.log('🧪 SIMULANDO CLICK REALE SU BOTTONI...');
                    
                    try {
                        const buttons = document.querySelectorAll('button[onclick*="openAddModal"]');
                        
                        if (buttons.length > 0) {
                            const entrataBtn = buttons[0]; // Primo bottone (entrata)
                            
                            console.log('🎯 Testando click su bottone ENTRATA...');
                            console.log('📊 Bottone elemento:', entrataBtn.tagName);
                            console.log('📊 Onclick attribute:', entrataBtn.getAttribute('onclick'));
                            console.log('📊 Bottone disabled:', entrataBtn.disabled);
                            console.log('📊 Bottone style.display:', entrataBtn.style.display);
                            console.log('📊 Bottone visibility:', getComputedStyle(entrataBtn).visibility);
                            
                            // Simula il click reale con tutti gli eventi
                            console.log('🔥 SIMULANDO CLICK EVENTO...');
                            
                            // Crea evento click reale
                            const clickEvent = new MouseEvent('click', {
                                view: window,
                                bubbles: true,
                                cancelable: true
                            });
                            
                            // Dispatcha l'evento
                            const result = entrataBtn.dispatchEvent(clickEvent);
                            console.log('📊 Click event dispatched:', result);
                            
                            // Verifica se modal è apparso
                            setTimeout(() => {
                                const modal = document.getElementById('add-modal');
                                const isModalVisible = modal && !modal.classList.contains('hidden');
                                console.log('📊 Modal visibile dopo click:', isModalVisible);
                                
                                if (!isModalVisible) {
                                    console.error('❌ PROBLEMA: Modal non si è aperto dopo il click!');
                                    
                                    // Debug aggiuntivo
                                    console.log('🔍 Debug modal:');
                                    console.log('   Modal exists:', !!modal);
                                    if (modal) {
                                        console.log('   Modal classes:', modal.className);
                                        console.log('   Modal style.display:', modal.style.display);
                                    }
                                } else {
                                    console.log('✅ SUCCESS: Modal si è aperto correttamente!');
                                }
                            }, 500);
                            
                        } else {
                            console.error('❌ Nessun bottone trovato!');
                        }
                        
                    } catch (e) {
                        console.error('❌ ERRORE nel test click reale:', e);
                    }
                };
                
                // 🧪 DEBUG COMPLETO MODAL - DISABILITATO PER NON APRIRE MODAL AUTOMATICI
                /*
                setTimeout(() => {
                    console.log('🔍 === DEBUG COMPLETO MODAL ===');
                    
                    // 1. Verifica esistenza modal nel DOM
                    const modal = document.getElementById('add-modal');
                    console.log('📊 Modal add-modal esiste:', !!modal);
                    
                    if (modal) {
                        console.log('📊 Modal innerHTML length:', modal.innerHTML.length);
                        console.log('📊 Modal className:', modal.className);
                        console.log('📊 Modal style.display:', modal.style.display);
                        
                        const computedStyle = getComputedStyle(modal);
                        console.log('📊 Modal computed display:', computedStyle.display);
                        console.log('📊 Modal computed visibility:', computedStyle.visibility);
                        console.log('📊 Modal computed position:', computedStyle.position);
                        console.log('📊 Modal computed z-index:', computedStyle.zIndex);
                        console.log('📊 Modal computed top:', computedStyle.top);
                        console.log('📊 Modal computed left:', computedStyle.left);
                        
                        const rect = modal.getBoundingClientRect();
                        console.log('📊 Modal rect:', {
                            width: rect.width,
                            height: rect.height,
                            top: rect.top,
                            left: rect.left,
                            bottom: rect.bottom,
                            right: rect.right
                        });
                    }
                    
                    // 2. Test apertura modal - COMMENTATO PER EVITARE APERTURA AUTOMATICA
                    console.log('🎯 Debug modal disponibile ma non attivo');
                    // openAddModal('entrata'); // DISABILITATO
                    
                }, 3000);
                */
            }, 2000);
        }
        
        }, initDelay); // Fine timeout inizializzazione
    });

    // 📨 Service Worker Messages
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.addEventListener('message', (event) => {
            if (event.data.action === 'open-expense-modal') {
                // Apri modal spesa da notifica
                if (window.financeApp && window.financeApp.openTransactionModal) {
                    window.financeApp.openTransactionModal('expense');
                }
            }
        });
    }
    </script>
    </div> <!-- Fine content-overlay -->
</body>
</html>